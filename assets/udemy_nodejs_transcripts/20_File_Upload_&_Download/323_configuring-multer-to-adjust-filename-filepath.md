## 323. Configuring Multer to Adjust Filename & Filepath

<strong><em>no description</em></strong>

We added multer and as you can see, multer is able to accept our incoming data,
extract the files and store them for us and then store information about the
file upload in this request file object here which we output which in the end
contains this data. 

Now all we have to do is we have to ensure that our data gets stored correctly
and for that we specify the destination folder but we can do more, we can set
the storage key here which gives us way more configuration options than just the
dest option. 

Now for that, to configure a storage here, I will actually set up a new
configuration object, maybe up there, file storage, the name is up to you. 

It's a constant and the value will be something I get from the multer package,
there it's the disk storage function. 

Disk storage is in the end a storage engine which you can use with multer and
there you can pass a javascript object to configure that. 

It takes two keys, it takes the destination and it takes the file name. 

These are two functions which multer will then call for an incoming file and
these functions then control how that file is handled regarding the place where
you store it and regarding the naming. 

So destination therefore is a function, we can make it an arrow function which
will be called by multer which receives the request object, the file object and
a callback which you have to call once you're done setting up the destination,
so this is all to interact with multer. 

So in there, you can for example call the callback with null as the first
argument, that would be an error message you throw to inform multer that
something is wrong with the incoming file and it should not store it but if that
is null, you tell multer that it's OK to store it and then the second argument
is the place where you do want to store it, like that images folder. 

Now file name also is a function, so it's also an arrow function where we also
received the request object, some data about the file and a callback which we
have to call to let multer know how to name it and there, we can also call this
with null to still inform multer, ok we're fine store it please and then the
second argument is the file name which we want to use and here we could name it
image.png but of course that would be a bit boring, instead we can extract file
and then there is an original name object which holds the original file name,
there also is a file name object which holds this random hash and in the end
what we can do here is we can of course combine this. 

We can for example say I want to ensure that if we have two images with the same
name, they don't overwrite each other. 

So I will use that file name which is auto-generated by multer and then I'll
concatenate it maybe with a dash in-between with the original name. 

With that I also ensure that I end with that extension and now I set my own
filename here by calling that callback. 

Now we just need to inform multer that we want to use this storage engine and we
do this by setting this as a value for the storage key in the multer options. 

Now with that if I go back and I added my product again, so the same input, both
png elected, you will see that in those images folder you have undefined
boat.png. 

Now it's simply undefined here instead of that random hash because since we did
set our own filename with this function here, multer does not generate that hash
but all we can do for example is we can use the current date, so new data to ISO
string gives us a snapshot of the current date and that should also ensure
uniqueness. 

If you need more, you can use some third party package that does give you a
really unique hash. 

But with this we're now storing files with the right extension and a unique name
and this gives us more power because now we can control the path and the
filename. 

And of course, we can also use that for even more because maybe we want to
validate that we only support certain mime types, let's say png and jpg but not
gifs or pdfs. 

Let's do that in the next lecture. 

---