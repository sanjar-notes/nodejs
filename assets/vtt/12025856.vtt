WEBVTT

00:02.510 --> 00:09.880
Now we added our multer configuration to rename our file and to control the storage place in detail,

00:10.040 --> 00:14.320
now we can also add a filter to multer to only allow certain kinds of files

00:14.550 --> 00:21.240
and for that 2D object where we configure multer, I can add the file filter function here.

00:21.440 --> 00:29.520
Now I'll again create in a separate const up there to make it easier to read, file filter will simply be

00:29.610 --> 00:31.380
a function,

00:31.520 --> 00:34.180
I'll use an arrow function here where I get the request,

00:34.220 --> 00:39.740
some file data and a callback which I have to call and in there, we should call the callback with

00:39.740 --> 00:47.120
null as an error and true if we want to accept that file so if it should be stored or false if we

00:47.120 --> 00:49.260
don't want to store that file.

00:49.310 --> 00:51.860
Now how can we determine whether we want to store it?

00:52.010 --> 00:54.120
Well we can write any logic we want here,

00:54.320 --> 01:05.650
now I will check if the file mime type is equal to an image/png or if the file mime type is

01:05.710 --> 01:14.860
equal to image/jpg or if the file mime type is equal to image/jpeg with an e.

01:15.130 --> 01:21.460
If any of that is true, so if I have a file which is of that type, then I will accept that so I will call

01:21.460 --> 01:23.690
the callback with true as a second value

01:23.830 --> 01:29.790
otherwise I'll call the callback with false as a second value which means I'll not accept that file.

01:30.010 --> 01:35.600
And now we can use that file filter and pass it as a value for file filter in our options here

01:35.860 --> 01:36.860
and with that set up,

01:36.880 --> 01:40.720
we got some logic here that should filter out invalid files.

01:40.750 --> 01:50.660
So if I go back now and I submit a form here with let's say my boat.png, I succeed here, well I get

01:50.660 --> 01:53.720
an error here but I succeed because it stores the file

01:54.230 --> 02:00.370
but if I try to submit a different value, let's say I'll pick a pdf here.

02:00.520 --> 02:07.960
You can use any pdf, any non-image file, then you see I only get undefined here and that undefined

02:08.260 --> 02:11.370
is stemming from my admin controller from this line,

02:11.380 --> 02:13.380
so then multer did not store anything

02:13.450 --> 02:16.060
and this is how we can filter out files.

02:16.090 --> 02:21.520
Now I will remove all these files up there and I'll also clean up my database soon because right now

02:21.520 --> 02:23.800
we're not really storing the data appropriately

02:23.860 --> 02:26.240
and that is the next step we should do of course.
