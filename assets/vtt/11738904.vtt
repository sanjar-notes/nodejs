WEBVTT

00:02.300 --> 00:07.670
So to pre-populate this form with the product data, we need to fetch the product first,

00:07.670 --> 00:16.190
so for in added mode here after not being redirected, then I want to get my product information. For this

00:16.340 --> 00:22.250
I need the product model which I already have and I need the product ID, prod ID can be retrieved from

00:22.250 --> 00:27.940
the incoming request because if you check the routes real quick, we have that dynamic segment here, 

00:27.950 --> 00:31.640
so by this name we can extract the Product ID.

00:31.890 --> 00:39.740
So in admin.js, here I can set or I can access request params product ID and get that ID from the URL.

00:40.190 --> 00:47.840
Therefore I can then use my product model and find this product by id and then here, I have my callback

00:47.840 --> 00:52.940
where I receive the product that was retrieved and by the way of course, you should also try to add

00:52.940 --> 00:58.640
a check to see if you have a product and redirect the user in case you don't but let's do it like this for

00:58.640 --> 00:59.280
now.

00:59.540 --> 01:07.100
So here I will now get my product and I will then render this page assuming that I always get a product and

01:07.100 --> 01:13.050
pass my product on a product key and you can name this key whatever you want of course.

01:14.600 --> 01:20.000
And we can for example add a check if we don't have a product, so if this is invalid, if it's undefined

01:20.390 --> 01:26.210
then we could return a redirect for now which is not the best user experience,

01:26.210 --> 01:28.840
most of the time you would want to show an error instead

01:28.970 --> 01:32.180
but let's now, for now do it like this.

01:32.180 --> 01:36.360
So we assume we always make it here and we get the product in the view now,

01:36.530 --> 01:41.680
so let's move over to the edit product view. And here first of all let's work on that button.

01:41.750 --> 01:43.170
Right now it's add product

01:43.310 --> 01:47.320
but I want to change that button caption if we're in edit mode.

01:47.330 --> 01:54.140
Now remember we're setting this editing property here so this is a variable available in the template.

01:54.140 --> 02:03.230
So here I simply want to check if editing and then add a curly brace,

02:03.320 --> 02:11.560
if this is true then I actually want to display the edit or maybe update product text here on the button

02:14.220 --> 02:22.080
otherwise and for that, I'll close the first if block here and add an else block still in my ejs tags

02:22.080 --> 02:22.900
of course.

02:22.950 --> 02:29.040
So otherwise here if we're in this else block here, I want to show add product and thereafter I also have

02:29.040 --> 02:35.700
to close my curly brace of that if statement. If I now reload this page, we see update product correctly

02:35.700 --> 02:41.810
and by the way if I go to add product, I'll now get an error because editing is not defined.

02:44.040 --> 02:52.440
So to fix this, I also have to make sure that in my controller, for showing the add product page, I set

02:52.460 --> 03:00.510
editing to false of course. And now here reloading this page will work,

03:00.620 --> 03:06.120
going back to the editing page will show us the update button.

03:06.200 --> 03:08.910
Now that is one step, back to the template

03:09.020 --> 03:11.640
I don't just want to show the caption here,

03:11.660 --> 03:17.360
I also want to change the action. So here on the form, the route we're sending the request to should also

03:17.480 --> 03:18.530
change of course.

03:18.530 --> 03:25.470
Right now it's always add product but it should only be add product if we are not in editing mode.

03:25.490 --> 03:26.400
So here indeed

03:26.630 --> 03:28.490
I will also output something dynamic,

03:31.200 --> 03:33.840
I will check if we're editing,

03:34.310 --> 03:36.450
so I'll have the same logic as for the button

03:36.470 --> 03:44.700
and if this is the case, I went to load /edit product let's say, otherwise I'll close that and have

03:44.700 --> 03:54.010
my else block open up, so otherwise this is my ejs else block, I'll add add product into my url here

03:54.340 --> 03:57.010
and I can inject these segments into the url

03:57.100 --> 04:00.280
because this will just be converted to normal text in the end.

04:01.060 --> 04:04.030
This is what ejs does or or what all templating engines do.

04:04.240 --> 04:09.750
So also close that curly brace of the else block here and with that if I save this, we should make

04:09.750 --> 04:14.350
sure that if we click that update button, we go to edit product.

04:14.370 --> 04:20.010
Well let's go back and let's see if we can pre-populate this with product information.

04:20.010 --> 04:26.760
Now keep in mind that in admin.js, I am retrieving the product, whoops not here but here in get edit

04:26.770 --> 04:30.390
product and I pass the product information into my view.

04:30.690 --> 04:33.450
So therefore in the view, we can of course use that

04:33.790 --> 04:38.810
and we can set it on all our inputs, here on value,

04:38.920 --> 04:44.410
I also want to check if I'm in editing mode and if I am, I want to display my product information, if

04:44.410 --> 04:46.790
I'm not I don't want to do that.

04:46.810 --> 04:48.640
So same logic as before,

04:54.190 --> 05:01.750
I'll check if I'm editing, if I am then I will display product title here because this is the title input

05:02.560 --> 05:07.370
otherwise I will not do anything and therefore I don't even need an else block,

05:07.420 --> 05:09.880
I just do this if I am in editing mode

05:10.000 --> 05:11.530
otherwise nothing will happen.

05:11.890 --> 05:19.780
So if I now reload this, we indeed see product title and the issue here is that of course this is simply

05:19.780 --> 05:23.130
output as text, to output the real value behind it,

05:23.230 --> 05:31.930
we need that equals ejs tag here nested into our other ejs tags like this,

05:31.930 --> 05:37.620
so this was now added, equals unclosing with a dollar sign greater than sign.

05:37.870 --> 05:39.820
And this can be hard to read,

05:39.820 --> 05:44.530
you simply have to divide it up in blocks, you've got if, then you've got the output and then you've got

05:44.530 --> 05:51.120
the closing curly brace for and with that saved if you now reload, you'll see the real title behind

05:51.120 --> 05:54.920
that. Now let's do the same for all the other values,

05:55.050 --> 05:59.580
so I'll just copy that value here real quick, for the image url.

05:59.670 --> 06:02.240
I obviously want to output image

06:02.250 --> 06:07.070
url, for the price.

06:07.210 --> 06:13.210
I want to output product price. For the description we get a text area,

06:13.340 --> 06:20.890
so here I will not have value equals, I'll just output the value between the opening and closing text

06:20.890 --> 06:22.180
area tags

06:22.290 --> 06:26.430
and here I'll output the description. And with that all saved

06:26.440 --> 06:29.050
if we reload, this is looking good

06:29.140 --> 06:32.070
and now we can start editing our products.

06:32.500 --> 06:37.550
Now I want to hook up that edit button so that we can really load the product and this newly added view.

06:37.750 --> 06:38.700
So let's do that

06:38.830 --> 06:44.080
and then also work on the functionality to store the updated information over the next lectures.
