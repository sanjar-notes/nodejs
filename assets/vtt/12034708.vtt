WEBVTT

00:02.310 --> 00:08.160
We have some basic code in place to extract values about the product which we want to delete,

00:08.280 --> 00:14.400
now to continue, we need a route on the backend to which we can send our javascript request. For that

00:14.410 --> 00:17.340
let's go to the routes folder and there to admin.js.

00:17.550 --> 00:24.750
Obviously we already have a delete route here, a delete product route and we can build up on that route,

00:24.750 --> 00:26.690
there is nothing wrong with that

00:26.970 --> 00:32.790
but now since we'll send the request directly through javascript, we can actually use a different http

00:32.790 --> 00:33.260
verb.

00:33.450 --> 00:40.680
Thus far we always use get and post because the browser natively supports these for the requests sent by

00:40.680 --> 00:43.820
the browser, by form submission and by clicking links,

00:43.890 --> 00:48.420
it only knows get and post. When we send requests through javascript,

00:48.420 --> 00:54.870
so through browser side javascript, we have access to other http verbs too and you'll learn more about the

00:54.870 --> 00:58.160
different http verbs in the rest API section.

00:58.200 --> 01:02.110
One of them is delete and this is a http verb,

01:02.190 --> 01:05.660
so http method which makes a lot of sense for deleting.

01:05.790 --> 01:07.450
Now it's only a semantic thing,

01:07.530 --> 01:14.250
we could use post, you can in general use any http verb to do anything because you define with your server

01:14.250 --> 01:14.910
side logic

01:14.910 --> 01:15.750
what will happen

01:15.990 --> 01:21.670
but it makes sense to try to be clear about your intention and there is a delete verb,

01:21.780 --> 01:22.970
we can now use it

01:23.010 --> 01:24.400
so why wouldn't we use it.

01:24.660 --> 01:28.680
So now this is a delete route to delete product,

01:28.680 --> 01:38.320
now I can also change this a bit and may be name this product- and then the product ID as a dynamic

01:38.320 --> 01:38.890
parameter

01:38.920 --> 01:43.010
because delete requests can have dynamic url parameters.

01:43.060 --> 01:49.660
So now we can extract that information from our url and I'll leave the controller action as it is

01:49.690 --> 01:56.170
but I will now name it delete product like this because we are not sending a post request anymore

01:56.230 --> 01:59.750
so I guess this name makes more sense, isAuth

01:59.770 --> 02:00.380
is a middleware

02:00.400 --> 02:01.800
I will keep in place though.

02:03.500 --> 02:10.460
So now with that, let's go to the admin controller and here, I'll rename that function, that handler here to
 
02:10.460 --> 02:15.920
delete product because I renamed it in the routes file too and now the product ID first of all is not

02:15.920 --> 02:21.590
extracted from the request body anymore because delete request as it turns out also are not allowed

02:21.590 --> 02:22.990
to have a request body 

02:23.270 --> 02:26.960
but instead, we now have that url parameter

02:26.960 --> 02:27.760
product ID,

02:27.830 --> 02:29.990
so I can extract my ID from there.

02:29.990 --> 02:34.080
So I simply change body for params and that's it,

02:34.340 --> 02:39.590
so that gives me my product ID. And then this logic here will still work,

02:39.590 --> 02:43.270
I only need to change the response I'll return.

02:43.490 --> 02:47.500
I will not redirect anymore because I'll not load a new page.

02:47.510 --> 02:53.480
Remember that the request triggering this action will be sent behind the scenes for the existing page,

02:53.480 --> 03:00.980
so I want to keep that existing page and therefore my response will be a response where I send json

03:00.980 --> 03:02.240
data.

03:02.240 --> 03:09.590
Json data is a special format and with expressjs, I can use a json helper method to conveniently

03:09.590 --> 03:15.190
return json data and json is simply a data format that looks like a javascript object,

03:15.230 --> 03:18.930
so with curly braces and then key value pairs,

03:19.130 --> 03:24.970
the only important thing about json is the keys have to be wrapped between double quotation marks.

03:25.060 --> 03:26.340
This is json data

03:26.480 --> 03:28.150
and this is what we can return here

03:28.370 --> 03:34.890
and now we can also set a status here of 200 maybe because for json data, this would be the default too

03:35.180 --> 03:41.720
but there since we don't redirect it and so on, where we get a status code set automatically, it would make

03:41.720 --> 03:49.340
sense to be very clear about the status code we have. And therefore here, I'll also not to use my default

03:49.520 --> 03:53.750
error handler where I would load the 500 page, instead here,

03:53.780 --> 03:56.850
I'll also return a response with status 500

03:56.870 --> 04:02.090
now, that is what I mean about setting that status on your own and there, I'll also return some json

04:02.090 --> 04:02.760
data,

04:02.780 --> 04:08.870
the question is of course which data. You simply pass a javascript object here which will then be transformed

04:08.960 --> 04:11.120
to json automatically for you.

04:11.180 --> 04:13.460
So here you can pass your normal javascript object,

04:13.460 --> 04:16.440
you don't need double quotation marks around your keys there

04:16.700 --> 04:20.610
and here we could have a message where I just say success,

04:20.720 --> 04:24.310
of course not that interesting but we could do that. And here

04:24.410 --> 04:30.590
I could have a message where I say deleting product failed.

04:30.770 --> 04:34.270
So now I have that in place and now we have two important changes,

04:34.280 --> 04:36.730
this is how we extract the params or the product ID

04:36.860 --> 04:41.500
and now we return json responses because we don't want to render a new page,

04:41.540 --> 04:43.680
we just want to return some data.

04:43.910 --> 04:50.090
Obviously we now have to continue in admin.js and make sure that we send the request and then work

04:50.090 --> 04:51.510
with the response data.

04:51.590 --> 04:52.880
Whoops, not this file though,

04:53.000 --> 05:00.580
I mean the one in the public.js folder, here. We worked on the server side and we added a new route

05:00.580 --> 05:06.100
or we changed the route to use the delete http verb and to look like this

05:06.190 --> 05:11.710
and now we need to send the request there from inside our client side admin.js file, so in the public

05:11.710 --> 05:19.420
folder. Here we can use the fetch method which is a method supported by the browser for sending http requests

05:19.670 --> 05:21.590
and it's not just for fetching data

05:21.670 --> 05:26.540
as the name might suggest, it's also for sending data. Here if

05:26.770 --> 05:28.440
you can pass a url,

05:28.540 --> 05:30.730
so we want to send a request to /product

05:30.730 --> 05:33.980
and then this of course needs to be replaced with the Product ID

05:34.240 --> 05:36.960
and this will send that to the same server

05:36.970 --> 05:41.140
if you don't specify a different host with http and then something,

05:41.200 --> 05:45.010
so if you have nothing like that, it will send it to the current host. Here

05:45.100 --> 05:53.050
I will add my prod ID of course and then the second argument is an object where you can configure this fetch

05:53.170 --> 05:54.880
request.

05:54.880 --> 06:00.430
Now here you can set a bunch of things, you could add a request body but not for a delete request as

06:00.430 --> 06:01.970
I just explained in the last lecture

06:01.990 --> 06:05.830
but for a post request which you can also send with that, you would set it

06:06.010 --> 06:09.120
and first of all let's define that this is a delete request.

06:09.130 --> 06:15.130
So I'll set method to delete here, doesn't have to be uppercase but it's a good convention.

06:15.580 --> 06:25.030
Now with method set, what else can we set? Well we can set headers and in the headers, we could encode

06:25.070 --> 06:29.440
our csrf token because we still need to attach this to our request

06:29.440 --> 06:31.410
and right now we are not doing that.

06:31.480 --> 06:35.800
We cannot send it in the request body because delete requests don't have a body

06:35.950 --> 06:41.710
but the good thing is the csurf package which we are using on a server does not just look into request

06:41.710 --> 06:42.360
bodies,

06:42.520 --> 06:46.470
it also looks into the query parameters and therefore we could add it there

06:46.570 --> 06:48.520
and it also looks into the headers.

06:48.610 --> 06:51.490
So there we can add a csrf token header,

06:51.490 --> 06:52.880
it will look for this key,

06:52.960 --> 06:58.990
you'll find all the keys for which it will look in the official doc. So you can add csrf token and then

06:59.020 --> 07:03.520
csrf as a value to attach this to your outgoing request as well.

07:03.520 --> 07:08.620
Now this will send the request and it will return a promise that allows to listen to the response

07:08.680 --> 07:17.320
and here I will console log any error I might be getting and here, I'll be console logging any result

07:17.350 --> 07:18.190
I might be getting,

07:18.190 --> 07:19.900
let's see what we have there.

07:19.900 --> 07:25.390
Now one important note by the way, I'm not sending any json data with my request here because it

07:25.390 --> 07:28.030
is a delete request without a post body.

07:28.030 --> 07:35.380
If it were and that is something we will see in the rest API section, then I would have to parse json

07:35.380 --> 07:39.520
data in my backend because there right now

07:39.550 --> 07:41.150
and that's just an important note,

07:41.260 --> 07:48.280
in app.js, there right now we only have two parsers, one for url encoded data which we

07:48.280 --> 07:55.050
don't have when we send json data and one for multipart data which we also don't have there. We would

07:55.050 --> 08:01.090
have to add a new body parser that is able to handle json data and extract that from incoming requests.

08:01.170 --> 08:06.220
I don't add it here because we don't need it here but we will add it later when we need it.

08:06.720 --> 08:11.120
So with that all in place, with our client side code adjusted,

08:11.260 --> 08:17.430
let's save all of that and let's simply click the delete button after reloading the page and see what we get.

08:18.140 --> 08:19.730
Let's click delete

08:19.870 --> 08:22.710
and I first of all get a 404 error that

08:22.710 --> 08:26.090
this route is not found, product with some ID

08:26.370 --> 08:33.510
and this makes sense because my route, product product ID is in the admin routes folder, of course we

08:33.510 --> 08:38.540
only get there if our request path starts with /admin,

08:38.550 --> 08:40.660
that is what we configure in the app.js file.

08:40.860 --> 08:47.160
So in my client side admin.js file in the public folder, I should of course point at /admin

08:47.160 --> 08:51.500
/product/product ID, so that's a little mistake on my side.

08:51.600 --> 08:54.120
Let's now reload after changing this

08:54.350 --> 08:56.190
and now this is looking good,

08:56.240 --> 09:03.380
I get a response with a status code of 200, with request body which is a readable stream,

09:03.380 --> 09:07.300
I'll show you how to get to that request body in a second

09:07.610 --> 09:11.710
and if I reload the page, the product is indeed gone.

09:11.720 --> 09:13.090
Now that's a step forward

09:13.160 --> 09:16.390
but of course I don't just want to reload the page,

09:16.400 --> 09:18.050
it should be gone immediately,

09:18.050 --> 09:21.800
that would be the main idea of doing this behind the scenes.

09:21.800 --> 09:23.390
So how can we make this work?
