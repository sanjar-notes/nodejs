WEBVTT

00:02.150 --> 00:11.090
Time to edit products and for this, I'll first of all work on my admin.js file in the controllers folder.

00:11.240 --> 00:18.050
There we have two routes that are or two functions that are related to editing products. To get edit

00:18.050 --> 00:23.840
product page which is responsible for fetching the product that should be edited and for rendering it

00:24.230 --> 00:29.810
and the post edit product page which is responsible for saving these changes to the database,

00:29.840 --> 00:31.830
I'll comment both back in

00:31.910 --> 00:33.930
and let's start with get edit

00:33.940 --> 00:38.200
product. There the majority of the code can stay as it is

00:38.360 --> 00:43.180
but when we then fetch the fitting product, we of course do this differently,

00:43.430 --> 00:50.490
we use product find by id and we find the product with Prod ID like this

00:50.630 --> 00:53.120
and then we still get back products however,

00:53.330 --> 00:55.730
well actually we don't get back products anymore,

00:55.910 --> 01:03.250
we get back one product here so no need to store it in a constant like this and extract it from an array,

01:03.290 --> 01:10.100
we get back one product automatically because we wrote that method in such a way and we therefore can

01:10.130 --> 01:12.200
render this product,

01:12.270 --> 01:14.170
so this should work.

01:14.220 --> 01:19.030
Now let's quickly have a look at the view that belongs to this controller action,

01:19.080 --> 01:23.940
so to this edit product.ejs file and in there, you know what I'm looking for,

01:24.030 --> 01:30.120
we want to make sure we're always using product_id when using the product ID just to make

01:30.120 --> 01:35.050
sure that we extract the right thing from the document we get back from the server.

01:35.670 --> 01:42.750
So now with that, we get everything in place to hopefully make this edit button work partly, if I click on

01:42.750 --> 01:43.380
it,

01:43.770 --> 01:47.860
well almost, let's leave it on this page.

01:47.910 --> 01:53.310
The controller should work but in the routes in the admin.js file, I of course have a comment this get route

01:53.340 --> 01:54.200
back in,

01:54.210 --> 01:56.080
so let's make sure this is done.

01:56.130 --> 02:03.390
And now that if we now reload that page, we indeed see the form with the default values filled back in.

02:03.390 --> 02:04.980
So now this is working

02:05.010 --> 02:08.410
but of course it's not that useful to only see the data

02:08.460 --> 02:15.980
and we were able to fetch data before, the interesting part now would be to update it. Now to update it,

02:15.990 --> 02:19.200
let's go back to the product model.

02:19.650 --> 02:28.400
How could we update our product which is stored in the database? Well

02:28.900 --> 02:36.780
let's go to the constructor and let's add a fifth argument here, the ID and then I'll say this _id

02:36.770 --> 02:38.830
is equal to the ID I'm getting here,

02:38.830 --> 02:42.040
you could name this _id here too if you wanted to.

02:42.040 --> 02:46.540
So now we accept a kind of optional fifth argument,

02:46.600 --> 02:49.070
we're not passing it in the other places of the app

02:49.090 --> 02:56.980
but here I do at least create the option of passing this too. An ID will therefore be undefined and be

02:56.980 --> 02:58.640
auto generated by mongodb

02:58.760 --> 03:06.010
or we did set it and then when we called save, I don't want to insert one,

03:06.010 --> 03:08.670
I want to create a new product instead.

03:08.680 --> 03:16.240
So for this what I'll do is I'll simply check if this _id, if that is set and if it is set,

03:16.540 --> 03:18.840
we'll update the product

03:19.950 --> 03:22.220
otherwise we'll insert it,

03:22.260 --> 03:25.490
so I'll move my const db function up there,

03:25.500 --> 03:28.340
I always need access to the database in both cases

03:28.990 --> 03:39.770
and now I'll create a new variable, let dbOp for db operation and in the else case where we insert

03:40.130 --> 03:51.490
a document, dbOp is equal to my connection to the database and then connecting to collection and then

03:51.880 --> 03:59.820
inserting one and then down there, I can use dbOp to follow along and actually return that.

03:59.830 --> 04:06.940
So now I have one case where dbOp is simply my insert command and then I return my result or dbOp

04:07.000 --> 04:13.950
is access to my database and to the products collection still

04:14.480 --> 04:21.580
but then here I use update one and as the name suggests, update one will update exactly one element.

04:21.580 --> 04:25.860
There also is update many where you can update multiple elements at once

04:25.880 --> 04:29.580
but here I know I only want to update one, so I can use update one

04:29.600 --> 04:33.380
and now update one takes at least two arguments.

04:33.380 --> 04:41.030
The first one is that we add a filter that defines which element or which document we want to update,

04:41.030 --> 04:46.580
so here again I'll pass a javascript object and we can filter for equality also

04:46.790 --> 04:50.520
or run more complex queries which you again can learn about

04:50.520 --> 04:53.340
in my mongodb course if you want to and here

04:53.420 --> 04:58.610
I only want to find a document where the _id is equal to

04:58.870 --> 05:08.300
and now again I'll create a new mongodb objectid to which I pass this _id, so the ID which

05:08.330 --> 05:10.600
is part of that object here.

05:10.880 --> 05:18.920
So I'm looking for a document where the ID matches the ID I have here in my product I'm currently working

05:18.920 --> 05:25.810
with and for that document, we now as a second argument to update one,

05:25.820 --> 05:29.520
we now specify how to update that document.

05:29.560 --> 05:36.130
This again is a javascript object where we describe the update and this is now not the new object,

05:36.170 --> 05:42.620
so we don't say this here as you could imagine that we tell mongodb find me the existing

05:42.620 --> 05:45.280
document and replace it with this, update

05:45.280 --> 05:47.500
one does not replace.

05:47.630 --> 05:53.420
Instead we have to describe the operation and we do this by using a special property name which is understood

05:53.450 --> 05:59.150
by mongodb, kind of a reserved name you could say, $set.

05:59.180 --> 06:01.630
This again takes an object as a value

06:01.640 --> 06:08.000
and here we describe the changes we want to make to the existing document which we found with this

06:08.120 --> 06:09.500
filter.

06:09.500 --> 06:18.830
And here you could actually say this and you would instruct mongodb to simply set these key value fields

06:18.920 --> 06:23.610
which you have in your object here to the document it found in the database

06:23.930 --> 06:29.210
and therefore since these are only key value pairs which exist in the document in the database, it will

06:29.270 --> 06:34.060
update the values of the document in the database with your new values.

06:34.310 --> 06:39.800
You could also write this in a more verbose way and explicitly say title should be equal to this title

06:40.040 --> 06:40.870
and so on

06:40.910 --> 06:48.670
but since we want to replace all fields, we can just say this here. And now with that we have a database

06:48.670 --> 06:52.640
operation that will update an existing database object,

06:52.690 --> 06:59.290
by the way the ID will not be overwritten or anything like that, only the other fields are.

06:59.290 --> 07:05.350
So with that let's go back to our admin.js controller and and in post added product, that is the part I

07:05.350 --> 07:11.760
want to work on in the next lecture to make sure that we actually are able to save our product.
