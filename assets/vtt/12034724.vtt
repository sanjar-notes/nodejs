WEBVTT

00:02.340 --> 00:05.400
To add payment to our application, let's work on that

00:05.400 --> 00:08.940
checkout.ejs file with which we never work thus far.

00:08.940 --> 00:15.510
I want to go there before I actually place an order when I click on order now in my cart, so I'll go

00:15.510 --> 00:17.140
to this page first.

00:17.390 --> 00:19.800
For that, I'll copy the content of cart.ejs

00:19.810 --> 00:24.520
add it in checkout.ejs to make sure that I have my default head.

00:24.900 --> 00:27.930
I'll get rid of that stylesheet though, I don't need it here,

00:28.070 --> 00:29.840
I want to include the navigation, 

00:30.000 --> 00:32.490
the main content will be totally different though,

00:33.590 --> 00:37.750
I will keep my body however, so or my end here.

00:38.000 --> 00:44.540
So with that, I have everything set up to have a basic checkout page,

00:44.540 --> 00:48.410
now let's first of all make sure we reach that before we start adding stripe.

00:48.980 --> 00:52.740
For that we need a new route of course in a shop.js file,

00:52.790 --> 01:04.130
here we have our create order route and in the end what I need is a new route, a get route which we

01:04.130 --> 01:06.600
can name checkout and there,

01:07.130 --> 01:12.800
I want to be authenticated because we can only buy something if we are logged in let's say and

01:12.850 --> 01:18.140
then I'll use my shop controller and there, get checkout which is an action I still have to create. And in

01:18.140 --> 01:26.070
that get checkout page then, we'll have the possibility to create an order and so on.

01:26.090 --> 01:33.730
So for now, let's just add this and let's work on our controller then, on our shop controller and there

01:33.730 --> 01:35.940
I need a get checkout method.

01:36.190 --> 01:44.320
So maybe here before post order because logically, it comes prior to that, I'll have get checkout with request

01:44.320 --> 01:53.880
response and next and in there, I want to render my checkout page. So we can of course grab one of our

01:53.880 --> 01:55.420
other render functions here,

01:59.170 --> 02:04.090
render that, here I will render shop/checkout,

02:04.480 --> 02:08.720
the path can be checkout, it doesn't really matter, we don't have a naviagtion

02:08.740 --> 02:12.000
item we want to highlight, here we can checkout as a text

02:12.040 --> 02:14.290
and of course we need some data for the checkout.

02:14.290 --> 02:16.110
Now what do I want to return here?

02:16.240 --> 02:17.140
Well in the end,

02:17.410 --> 02:23.050
I will need the same data as I have in my cart, so I need my products here which I do have in the cart,

02:23.980 --> 02:27.810
so I can actually copy that entire code from get cart

02:27.820 --> 02:34.640
I guess and add this here and now just make sure we use shop

02:34.640 --> 02:38.480
checkout, path checkout and here,

02:38.640 --> 02:47.020
checkout but besides that I also need to calculate the total let's say. So total sum or whatever you

02:47.020 --> 02:51.780
want to name it and that total sum of course can be retrieved from our product data

02:52.120 --> 02:56.210
because in the cart or in the products here we have in the cart,

02:56.680 --> 03:02.410
you have to keep in mind that products is in an array of products where we have the quantity and

03:02.410 --> 03:09.550
then a product ID field with detail data about the products because we populate this product ID field

03:09.640 --> 03:20.030
with the detailed product data. So therefore, the total sum can be generated by looping through all products,

03:20.140 --> 03:22.480
so here I can do products forEach

03:25.320 --> 03:29.620
and create a new variable, total which is zero initially

03:29.940 --> 03:38.490
and then there, total is equal plus equal this shortcut to add something to the existing total, so total

03:38.490 --> 03:47.170
plus the product and then there is a quantity field times the product product ID price and then it's

03:47.170 --> 03:49.270
this total which I pass to my view.

03:49.270 --> 03:51.780
So that's all the data I should need in checkout view.

03:51.910 --> 03:55.010
So now back in my checkout.ejs file,

03:55.010 --> 03:59.330
now I can indeed grab that unordered list for rendering a list of items

04:00.520 --> 04:03.800
like this, I'll go through all my products.

04:03.860 --> 04:08.900
I'll remove the delete button though, it's too late at this point let's say, we can of course always cancel

04:08.900 --> 04:11.350
the checkout process if we want to though,

04:11.600 --> 04:17.810
actually I'll delete this entire form therefore, this is my unordered list and below that, we can add

04:18.000 --> 04:21.530
a div with a h2 tag of total

04:21.620 --> 04:26.690
and then here I output total sum.

04:26.720 --> 04:29.310
Now let's have a look at that and to have a look,

04:29.420 --> 04:36.050
I need to make sure that on cart.ejs when you click order now, I don't submit this form here,

04:36.320 --> 04:38.960
so I will actually comment this out,

04:38.960 --> 04:40.950
we don't need that anymore

04:41.420 --> 04:49.700
but instead I want to have a normal anchor tag here where I say order now where I simply point at

04:49.720 --> 04:50.310
/checkout,

04:50.390 --> 04:57.850
so this new route we added and I'll just give this a class of button to look a bit like a button. With

04:57.850 --> 04:58.670
all that added,

04:58.750 --> 05:00.830
let's go back to our page,

05:00.970 --> 05:09.740
let's go to products here maybe, add this to the cart and click order now and this is now my,

05:10.100 --> 05:11.420
well a page here.

05:11.430 --> 05:14.250
Now it's not looking super beautiful I'd say,

05:14.910 --> 05:20.520
I need to include that cart.css file again because since I'm reusing the rest of the code here and we could

05:20.520 --> 05:25.130
create our own stylesheet but I want to keep this relatively short, since I'm using all that,

05:25.170 --> 05:28.720
I of course also want to use the same styles.

05:28.860 --> 05:32.860
So now if I reload this checkout page here, it's looking ok,

05:32.940 --> 05:40.080
the total could be placed in the middle maybe, we can do that by giving this div a class of centered

05:40.080 --> 05:47.630
which is a utility class I added earlier in the course and now we have this checkout page.

05:47.630 --> 05:52.100
Again we can always work on the visuals but it's not so much about the visuals here.

05:52.140 --> 05:58.020
So now we have this total and now I want to add stripe and for that, let's first of all set up an account

05:58.020 --> 05:58.350
with them.
