WEBVTT

00:02.100 --> 00:05.340
So let's start with registering the routes then

00:05.340 --> 00:11.790
and for this I will go into the routes folder. There we have admin and shop and this still sounds like

00:11.790 --> 00:13.700
a decent differentiation

00:13.800 --> 00:16.400
and let's start with the shop related routes.

00:16.410 --> 00:18.600
Right now we got the starting page,

00:18.600 --> 00:24.930
now we will also need a get route for /products because if we have a look into our navigation.ejs

00:24.930 --> 00:33.040
file, this is this new link which we added, so /products. We'll also need /cart because that's

00:33.070 --> 00:34.870
another new link we have and

00:34.870 --> 00:39.450
this will also be a get route and I will of course also add controller functions

00:39.540 --> 00:47.730
but I'll first define all the routes. So I'll also need /cart and later, I'll also need a route for

00:47.730 --> 00:48.990
the checkout process,

00:49.020 --> 00:55.290
so /checkout is already something we can also add and obviously you are free to edit any of these

00:55.300 --> 00:56.880
paths to your liking,

00:57.030 --> 01:02.790
just make sure to then adjust the links you might have in your application. Now

01:02.810 --> 01:10.220
besides visiting /products, we will also need a single product and that will then actually contain

01:10.220 --> 01:12.530
some new logic to which I will come back

01:12.530 --> 01:14.980
so let's stick to these general routes for now.

01:15.170 --> 01:17.980
Of course we also need more than just the shop routes,

01:17.990 --> 01:21.580
we also got some admin routes, in a navigation for example,

01:21.590 --> 01:26.210
we got the new admin products here and then we'll also need a route for editing,

01:26.210 --> 01:30.540
we'll add this later and for deleting, also something I'll add later.

01:30.540 --> 01:34.290
So for now let's simply go to admin.js and there I will add

01:34.310 --> 01:40.710
a new get route because I want to load a new page and that will just be /products. Now

01:40.730 --> 01:47.730
never forget this is just as the other routes also already in a path that starts with /admin

01:47.750 --> 01:54.410
because this is what we filter for in app.js and of course we'll also need a controller function for that.

01:54.720 --> 01:55.000
Ok

01:55.040 --> 01:56.190
so this is looking good,

01:56.300 --> 01:58.600
now how about the controllers?

01:58.640 --> 02:01.460
Now we can follow different approaches there,

02:01.490 --> 02:06.800
obviously most of the things we have are still related to products but we also got some new routes like

02:06.800 --> 02:08.420
cart or checkout

02:08.960 --> 02:11.710
and later we'll also add orders for example.

02:11.930 --> 02:13.270
So we got that,

02:13.400 --> 02:18.740
now these are implicitly of course related to products right,

02:18.740 --> 02:20.630
we do buy products in the end

02:20.900 --> 02:28.100
but we could also argue that semantically or from a logic perspective, they rather belong to the general

02:28.160 --> 02:29.980
shop idea.

02:30.290 --> 02:38.450
So now we might be back to actually using a shop controller and a new admin controller so that we can

02:38.450 --> 02:41.330
split our logic by these two sections,

02:41.330 --> 02:46.820
alternatively you could of course also think about using a products controller and a shop controller and

02:46.820 --> 02:52.160
have everything related to products only in the products controller and things like cart and checkout

02:52.240 --> 02:53.690
in the shop controller

02:53.750 --> 02:55.440
but I will go for this setup.

02:55.820 --> 03:03.020
Now that of course means that my two admin related routes, get add product and post add product should

03:03.020 --> 03:04.470
be removed from the shop.js

03:04.510 --> 03:07.850
file and go into the admin.js file,

03:07.850 --> 03:09.440
this makes more sense.

03:10.440 --> 03:12.690
I will also need my model here though,

03:12.750 --> 03:17.950
so let's take that import and also add it here in the admin.js file.

03:17.970 --> 03:21.380
This has implications for my routes because in the admin routes,

03:21.390 --> 03:23.620
I'm still importing the shop controller,

03:23.760 --> 03:31.740
well this should now become the admin controller and therefore I should also rename it to admin controller

03:31.850 --> 03:38.610
up here and then replace it down there and a similar thing needs to be done in the shop.js file in

03:38.610 --> 03:39.830
the routes folder.

03:39.980 --> 03:48.120
There we import the shop controller which is good but I should also name it shop controller then and then of course

03:48.120 --> 03:50.350
also replace that.

03:50.420 --> 03:52.260
So this looks a bit cleaner to me

03:52.340 --> 03:58.630
and with that, we can now also hook up our other routes. For this of course we first of all need to add them though,

03:58.630 --> 04:08.390
so let's start with shop.js and there I will export a new page and that should be my get index function

04:08.390 --> 04:10.000
here, there

04:10.010 --> 04:19.040
I want to render the index page so I will get my middleware function here and in there of course I also

04:19.040 --> 04:22.010
want to fetch some products and render a view.

04:22.370 --> 04:26.110
For now I will therefore simply copy the logic from get products,

04:26.120 --> 04:31.870
so for now the two pages are the same but I will render shop index here,

04:31.970 --> 04:34.890
so using that index page view here

04:35.030 --> 04:39.590
and even if we have the same products on there, we can of course work on the view and show a different

04:39.590 --> 04:42.540
starting text there for the starting page,

04:42.560 --> 04:44.020
anything like that.

04:44.490 --> 04:49.510
OK now we got get index and get products and if we go to the routes file,

04:49.510 --> 04:55.580
this means that for slash anything, I actually want to load the get index function

04:55.580 --> 05:01.580
here in my controller because that is the starting page and it's for /products that I want to load

05:01.760 --> 05:03.640
get products instead.

05:04.730 --> 05:10.010
We also need to load the cart and checkout pages and therefore let's go back to the shop controller

05:10.460 --> 05:15.480
and there, we got get index and get products,

05:15.550 --> 05:23.440
I will export something new and that will be get cart and there again, request, response, next is what

05:23.440 --> 05:24.450
I have here

05:26.180 --> 05:35.460
and I will render a new view here and that view will be shop/cart, pointing at the cart.ejs

05:35.460 --> 05:39.390
file in the shop folder and I will pass some data to it,

05:39.390 --> 05:45.800
for example I need to set the path to /cart. By the way for product list here,

05:45.810 --> 05:51.940
I also need to set it to /products because that is the path we're checking for in the navigation,

05:51.960 --> 05:57.480
we can also change the title here maybe to all products and on the starting page,

05:57.540 --> 05:59.510
I leave it at shop.

05:59.640 --> 06:01.920
I pass the products to both views,

06:02.190 --> 06:04.520
I don't really need that code anymore,

06:04.560 --> 06:08.000
that is a relict we have from the handlebars times,

06:08.130 --> 06:10.690
we don't need that so we can remove that.

06:10.830 --> 06:12.330
Now for the cart view,

06:12.450 --> 06:21.250
I will therefore also add a page title and there, I will simply say your cart and that is it for now,

06:21.250 --> 06:24.760
later we'll also add or load the cart items

06:24.760 --> 06:26.940
but let's not focus on that for the moment.

06:27.780 --> 06:32.240
Last but not least, let's load the checkout page with get checkout

06:32.320 --> 06:38.840
and there we have a request, the response and next and here I then also render a view,

06:38.970 --> 06:42.110
the view here is shop checkout

06:42.270 --> 06:48.270
and then we need to pass some data where I set the path to /checkout and where I also set the page

06:48.270 --> 06:53.430
title to checkout, so that all our views get the data they should need.

06:53.850 --> 06:54.930
Now that's looking good,

06:55.080 --> 07:01.860
let's go back to the shop.js file in the routes folder then and there we can use these new routes. For

07:01.920 --> 07:02.930
the cart route,

07:02.940 --> 07:10.970
we can use shop controller get cart and for checkout, we can use shop controller get checkout, the two

07:10.980 --> 07:14.810
new controller functions we created.

07:14.820 --> 07:19.470
Now we're almost done with the controllers and the routes, at least the basic setup,

07:19.650 --> 07:24.890
let's now go to admin.js and there we also have one route, products,

07:24.890 --> 07:30.540
so let's go to the admin.js in the controllers folder and there I will add a new route,

07:30.540 --> 07:40.380
exports get products is my normal middleware function and here I basically want to do the same as I

07:40.380 --> 07:43.260
do in get products in the shop. Here

07:43.290 --> 07:49.740
I simply want to fetch all products and then render my view, so I will copy that code, go to admin.js

07:49.980 --> 07:51.730
and put that into this route,

07:51.830 --> 07:55.770
fetch all products but of course then render a different view,

07:55.800 --> 07:58.650
I want to render admin/products,

07:58.650 --> 08:01.110
so this view here should be rendered.

08:01.170 --> 08:05.230
I will also name it admin products

08:05.360 --> 08:13.160
and the path will be /admin/products to mark that correctly in the navigation. With all

08:13.160 --> 08:13.730
that setup,

08:13.730 --> 08:19.240
if we go back and reload, we see a white page which is a good sign because it's not an error

08:19.430 --> 08:26.300
and we do see a white page because actually for slash nothing which is the route I'm on here, we load

08:26.720 --> 08:30.170
or we execute get index in the shop controller

08:30.170 --> 08:36.020
and this actually yields us shop index which happens to be an empty ejs view,

08:36.200 --> 08:37.860
so therefore we see an empty page,

08:37.880 --> 08:39.150
makes sense.

08:39.260 --> 08:44.150
Let's take the code from product list.ejs and copy it into index.ejs

08:44.360 --> 08:51.770
and if we leave it as it is and we reload, we now see shop and we see the products, the same is the case

08:51.770 --> 08:55.430
for the products page because they share the same code for now,

08:55.760 --> 08:57.220
cart is empty again

08:58.350 --> 09:03.840
and therefore we should add some content there too, at least we should include the head and the navigation

09:03.840 --> 09:05.570
so that we see something,

09:05.590 --> 09:09.710
so let's go to cart.ejs and add that include of the head,

09:10.020 --> 09:12.430
we don't need product.css here for now,

09:12.510 --> 09:20.010
we got the body start and then we get the navigation and then let's simply also add end.ejs so that

09:20.010 --> 09:22.030
we have a valid html document.

09:22.850 --> 09:30.470
With that added, if I reload this route here, we also see cart with nothing on, add product should still work

09:30.650 --> 09:34.930
and admin products won't work, let's copy the code from cart.ejs

09:35.060 --> 09:41.120
and let's head over to products in the admin folder, in the views folder, paste it in there so that we at

09:41.120 --> 09:45.140
least see that and therefore if I now click on admin products,

09:45.170 --> 09:50.990
it looks like it tries to render the 404 page but has an error there.

09:51.080 --> 09:52.540
Now that means two things,

09:52.580 --> 10:00.150
for one our route seems to be wrong, in admin.js in the routes folder, /products should be right,

10:00.170 --> 10:01.150
yeah but

10:01.160 --> 10:06.640
I didn't hook up my admin controller there, so we should add admin controller get products here in admin.js

10:06.640 --> 10:13.430
in the routes folder and on the other hand, also our 404 page had an issue because there

10:13.430 --> 10:16.340
we see that the path is not defined,

10:16.400 --> 10:24.610
so what I'm missing here is that for my 404 controller, the error controller to be precise,

10:24.620 --> 10:31.070
I also need to add a path here because I try to extract that path in my navigation and therefore I

10:31.070 --> 10:35.330
also should set the path here and I can set it to /404,

10:35.390 --> 10:36.490
doesn't really matter,

10:36.500 --> 10:37.890
it just needs to be there.

10:38.120 --> 10:40.700
So now reloading works because that's admin products

10:40.760 --> 10:44.600
but now even an unknown route will work again.

10:44.600 --> 10:45.890
So this is looking good,

10:45.890 --> 10:51.800
also note that the active item is displayed correctly in the navigation and therefore we made a huge

10:51.800 --> 10:52.750
step forward,

10:52.790 --> 10:58.620
we added a bunch of views, the fitting routes and controller actions even though they don't do that much yet.

10:58.790 --> 11:02.900
Now it's time to work a bit on the views and add a bit of logic already.
