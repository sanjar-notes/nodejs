WEBVTT

1
00:00:02.130 --> 00:00:04.090
<v Maximilian>We worked a bit on the cart model.</v>

2
00:00:04.090 --> 00:00:05.480
Some things are still missing.

3
00:00:05.480 --> 00:00:07.710
For example, we never display our cart

4
00:00:07.710 --> 00:00:10.710
and we also will never really...

5
00:00:10.710 --> 00:00:13.430
We're not able to delete an item from the cart

6
00:00:13.430 --> 00:00:15.550
but let's ignore that for the moment.

7
00:00:15.550 --> 00:00:19.200
Let's instead focus on editing a product.

8
00:00:19.200 --> 00:00:21.830
We get the edit-product.ejs file

9
00:00:21.830 --> 00:00:23.610
and in the end, what I wanna do in there

10
00:00:23.610 --> 00:00:28.350
is I want to render the same form I have for add-product.

11
00:00:28.350 --> 00:00:32.600
The difference will be that I want to pre-populate that form

12
00:00:32.600 --> 00:00:35.413
with the values of the product I wanna edit.

13
00:00:36.400 --> 00:00:40.920
Now, if I'm using the same HTML code in the end,

14
00:00:40.920 --> 00:00:44.730
it would make sense to reuse the same template.

15
00:00:44.730 --> 00:00:47.057
If you ever plan on using a different one,

16
00:00:47.057 --> 00:00:49.050
it doesn't, but here it makes sense.

17
00:00:49.050 --> 00:00:52.400
So what I'll do is I'll take my add-product.ejs code

18
00:00:52.400 --> 00:00:54.080
and move it into edit-product

19
00:00:54.080 --> 00:00:56.520
because I find this to be the more generic name

20
00:00:56.520 --> 00:00:59.660
and I'll delete the add-product.ejs file.

21
00:00:59.660 --> 00:01:01.720
So now we just have edit-product.ejs

22
00:01:01.720 --> 00:01:04.193
with all the HTML code in there that we need.

23
00:01:05.100 --> 00:01:06.310
Now, first of all,

24
00:01:06.310 --> 00:01:09.580
that means that I have to load that file

25
00:01:09.580 --> 00:01:14.150
in admin.js when we load getAddProduct.

26
00:01:14.150 --> 00:01:18.470
I no longer need the add-product path here,

27
00:01:18.470 --> 00:01:21.040
I need edit-product here only.

28
00:01:21.040 --> 00:01:23.370
The path down there can stay add-product

29
00:01:23.370 --> 00:01:25.020
because that is what we use

30
00:01:25.020 --> 00:01:28.200
for highlighting a certain navigation item.

31
00:01:28.200 --> 00:01:29.284
By the way, we can get rid

32
00:01:29.284 --> 00:01:32.793
of these additional information pieces.

33
00:01:33.690 --> 00:01:35.510
So now this should still work.

34
00:01:35.510 --> 00:01:37.260
If I click on Add Product,

35
00:01:37.260 --> 00:01:39.220
I still see that form.

36
00:01:39.220 --> 00:01:40.940
So that's looking good.

37
00:01:40.940 --> 00:01:43.870
However, for editing a product,

38
00:01:43.870 --> 00:01:45.640
I now also want to have a route

39
00:01:45.640 --> 00:01:47.800
and I wanna use that same view.

40
00:01:47.800 --> 00:01:50.970
So I'll copy that route here

41
00:01:50.970 --> 00:01:53.400
and add it maybe below postAddProduct

42
00:01:53.400 --> 00:01:54.873
to keep these two together.

43
00:01:56.080 --> 00:01:59.723
And here I will have getEditProduct as a action name.

44
00:02:01.850 --> 00:02:04.800
And I also wanna render edit-product here.

45
00:02:04.800 --> 00:02:07.060
The difference is that here I plan

46
00:02:07.060 --> 00:02:10.530
on passing in my product information.

47
00:02:10.530 --> 00:02:12.110
But the problem is, of course,

48
00:02:12.110 --> 00:02:15.030
how should I reach this controller action?

49
00:02:15.030 --> 00:02:15.870
And my idea

50
00:02:15.870 --> 00:02:19.350
is that since I already have my Edit button here,

51
00:02:19.350 --> 00:02:24.020
if I click that, I don't wanna call edit-product like this,

52
00:02:24.020 --> 00:02:26.950
I also want to add the ID of the product I wanna edit.

53
00:02:26.950 --> 00:02:28.500
So if I grab a real ID

54
00:02:28.500 --> 00:02:31.620
from my products.json file like this one,

55
00:02:31.620 --> 00:02:33.450
then I would have that in the URL

56
00:02:33.450 --> 00:02:34.550
and if I load this,

57
00:02:34.550 --> 00:02:37.340
now I want to have the form pre-populated

58
00:02:37.340 --> 00:02:38.890
with the data for this product,

59
00:02:38.890 --> 00:02:41.030
and if I hit the Save button,

60
00:02:41.030 --> 00:02:43.180
I, of course, don't want to create this product

61
00:02:43.180 --> 00:02:44.993
but simply edit the existing one.

62
00:02:45.950 --> 00:02:49.860
Now, this means that I need two things.

63
00:02:49.860 --> 00:02:52.070
The ID, I need to pass that,

64
00:02:52.070 --> 00:02:56.230
and the information that I want to edit a product

65
00:02:56.230 --> 00:02:58.220
instead of create it.

66
00:02:58.220 --> 00:03:01.630
Well, if we go to our admin routes,

67
00:03:01.630 --> 00:03:03.750
we can add a new route, first of all,

68
00:03:03.750 --> 00:03:06.600
this edit-product route here with the ID

69
00:03:06.600 --> 00:03:08.320
and you learned how that works actually.

70
00:03:08.320 --> 00:03:10.840
You can add a new route here.

71
00:03:10.840 --> 00:03:14.670
Get route will be at slash

72
00:03:14.670 --> 00:03:17.160
and then here the /admin is available

73
00:03:17.160 --> 00:03:19.470
for all routes in the admin.js file anyways

74
00:03:19.470 --> 00:03:20.390
as you know.

75
00:03:20.390 --> 00:03:22.640
So it's just edit-product

76
00:03:22.640 --> 00:03:24.380
and then the ID, and again,

77
00:03:24.380 --> 00:03:27.680
this is a variable, a dynamic path segment

78
00:03:27.680 --> 00:03:29.280
indicated with a colon.

79
00:03:29.280 --> 00:03:31.620
And then we can load the adminController

80
00:03:32.570 --> 00:03:37.570
and there the getEditProduct action we just added.

81
00:03:37.700 --> 00:03:39.440
So this is step number one.

82
00:03:39.440 --> 00:03:42.120
And actually, we now already can go

83
00:03:42.120 --> 00:03:45.480
to our admin.js controller

84
00:03:45.480 --> 00:03:49.150
and here we obviously know that we wanna edit a product.

85
00:03:49.150 --> 00:03:50.040
So what we can do

86
00:03:50.040 --> 00:03:54.330
is we can pass an additional information field

87
00:03:54.330 --> 00:03:58.260
to our view, editing, and set this to true maybe

88
00:03:58.260 --> 00:04:00.190
so that we can check this with the if condition

89
00:04:00.190 --> 00:04:02.050
to find out, for example,

90
00:04:02.050 --> 00:04:04.540
if upon clicking that Save button,

91
00:04:04.540 --> 00:04:06.150
we should try to add the product

92
00:04:06.150 --> 00:04:07.870
and send a request to that route

93
00:04:07.870 --> 00:04:11.200
or try to edit it and send it to a different route.

94
00:04:11.200 --> 00:04:16.200
But let's say we want to get an additional confirmation

95
00:04:16.510 --> 00:04:19.040
by ensuring that people have to pass us

96
00:04:19.040 --> 00:04:21.900
a so-called query parameter in the URL.

97
00:04:21.900 --> 00:04:24.560
A query parameter can be added to any URL

98
00:04:24.560 --> 00:04:26.000
by adding a question mark

99
00:04:26.000 --> 00:04:29.700
and then a key-value pair, separated by an equal sign,

100
00:04:29.700 --> 00:04:32.100
like edit equals true.

101
00:04:32.100 --> 00:04:34.400
And you can have multiple query parameters

102
00:04:34.400 --> 00:04:36.410
by separating them with ampersands.

103
00:04:36.410 --> 00:04:41.410
So we could also have title equals new, for example.

104
00:04:44.990 --> 00:04:46.780
So this is possible

105
00:04:46.780 --> 00:04:49.200
and this is so-called optional data.

106
00:04:49.200 --> 00:04:52.270
The path here, the route which gets reached

107
00:04:52.270 --> 00:04:55.000
is determined by the part up to the question mark.

108
00:04:55.000 --> 00:04:57.510
So you don't need to add any information

109
00:04:57.510 --> 00:04:59.340
about query parameters you might get

110
00:04:59.340 --> 00:05:00.600
to your routes file.

111
00:05:00.600 --> 00:05:02.640
These paths are not affected.

112
00:05:02.640 --> 00:05:05.266
But you can always check for query parameters

113
00:05:05.266 --> 00:05:07.260
in your controllers.

114
00:05:07.260 --> 00:05:11.070
So here we can check if const editMode,

115
00:05:11.070 --> 00:05:14.380
if this is set by going to our request

116
00:05:14.380 --> 00:05:16.530
and there will be a query object.

117
00:05:16.530 --> 00:05:19.850
This is also created and managed by Express.js.

118
00:05:19.850 --> 00:05:22.470
And you can access your data here

119
00:05:22.470 --> 00:05:26.510
by simply trying to access the keys you got

120
00:05:26.510 --> 00:05:27.930
in your query parameters.

121
00:05:27.930 --> 00:05:30.290
So for this query parameter that was added,

122
00:05:30.290 --> 00:05:31.613
you could check for edit.

123
00:05:32.466 --> 00:05:33.480
This would be your key.

124
00:05:33.480 --> 00:05:35.610
So I can try to access edit here

125
00:05:35.610 --> 00:05:38.610
and only if this is set somewhere

126
00:05:38.610 --> 00:05:40.220
in the list of query parameters,

127
00:05:40.220 --> 00:05:42.950
which can be separated with ampersands as I mentioned,

128
00:05:42.950 --> 00:05:44.090
if this is set,

129
00:05:44.090 --> 00:05:46.690
then I will get the value which is set.

130
00:05:46.690 --> 00:05:49.360
So now I would have true in editMode.

131
00:05:49.360 --> 00:05:51.490
And if I don't have it, if I don't find it,

132
00:05:51.490 --> 00:05:53.090
I'll simply have undefined,

133
00:05:53.090 --> 00:05:55.820
which conveniently is also treated as false

134
00:05:55.820 --> 00:05:57.580
in a Boolean check.

135
00:05:57.580 --> 00:05:59.840
So we can then pass editMode here

136
00:05:59.840 --> 00:06:03.820
and now we only enter editMode if this is set.

137
00:06:03.820 --> 00:06:05.390
And therefore, we could also check

138
00:06:05.390 --> 00:06:09.950
if not editMode and then simply redirect.

139
00:06:09.950 --> 00:06:12.740
Now, this is kind of a redundant thing here to do

140
00:06:12.740 --> 00:06:15.448
to be honest because actually here,

141
00:06:15.448 --> 00:06:18.320
we already know that we wanna edit the product.

142
00:06:18.320 --> 00:06:21.260
But I want to show you how you can use query parameters

143
00:06:21.260 --> 00:06:23.670
to set optional information,

144
00:06:23.670 --> 00:06:25.850
pass additional information.

145
00:06:25.850 --> 00:06:29.610
Often, this is also used for something like tracking users

146
00:06:30.560 --> 00:06:34.850
or for example, for keeping a certain filter the user set

147
00:06:34.850 --> 00:06:35.960
on a page.

148
00:06:35.960 --> 00:06:39.560
Here, I'll use it to explicitly set that editMode

149
00:06:40.740 --> 00:06:43.040
and redirect otherwise.

150
00:06:43.040 --> 00:06:45.010
So now I extract this

151
00:06:45.010 --> 00:06:46.490
and try to load this

152
00:06:46.490 --> 00:06:48.560
and therefore if I now save this

153
00:06:48.560 --> 00:06:52.130
and I connect my newly created action here

154
00:06:52.130 --> 00:06:55.940
with the route as I already did it here,

155
00:06:55.940 --> 00:06:57.770
if I now reload this page

156
00:06:57.770 --> 00:07:00.170
with the dynamic segment set

157
00:07:00.170 --> 00:07:02.530
and the query parameter added,

158
00:07:02.530 --> 00:07:05.470
then I land on this Add Product page,

159
00:07:05.470 --> 00:07:06.920
which is incorrect.

160
00:07:06.920 --> 00:07:08.680
I need to change that path.

161
00:07:08.680 --> 00:07:10.910
But that means that I don't get redirected,

162
00:07:10.910 --> 00:07:12.100
so I made it in there

163
00:07:12.100 --> 00:07:14.403
and editMode should be set to true.

164
00:07:15.340 --> 00:07:17.380
Now, we can also set the path here

165
00:07:17.380 --> 00:07:19.510
to edit-product to make sure

166
00:07:19.510 --> 00:07:21.420
that this is not highlighted here.

167
00:07:21.420 --> 00:07:23.700
Instead, I want to have no highlighted section

168
00:07:23.700 --> 00:07:26.560
and this will not be because I have no check

169
00:07:26.560 --> 00:07:29.840
in my navigation where I would look for this specific path.

170
00:07:29.840 --> 00:07:31.380
And I'll set the page title also

171
00:07:31.380 --> 00:07:33.500
to Edit Product for this route.

172
00:07:33.500 --> 00:07:36.480
So now if I reload this, this looks better.

173
00:07:36.480 --> 00:07:38.590
And as a next step in the next lecture,

174
00:07:38.590 --> 00:07:40.980
I now wanna use the fact information

175
00:07:40.980 --> 00:07:42.750
that I noted I'm in editMode

176
00:07:42.750 --> 00:07:47.750
in my view to pre-populate this with product information

177
00:07:48.380 --> 00:07:50.760
and then also to change the button caption

178
00:07:50.760 --> 00:07:52.553
and the button action.

