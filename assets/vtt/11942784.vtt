WEBVTT

00:02.130 --> 00:09.410
So let's work on our shop pages now and let's make sure we can use our data there. For this,

00:09.420 --> 00:15.790
let me go to my product model again and here, besides being able to save data,

00:15.810 --> 00:21.300
I of course also want to be able to get my products, so I'll add a static method again and I'll name

00:21.300 --> 00:24.050
that fetch all.

00:24.060 --> 00:32.370
Now here I want to interact with my mongodb database to fetch all products. For this, I will again

00:32.370 --> 00:39.370
return and then use db collection to tell mongodb to which collection to connect to and here

00:39.390 --> 00:40.000
the collection

00:40.020 --> 00:42.340
I want to connect to is products of course

00:42.750 --> 00:48.730
and then there, mongodb has a method for finding data which is called find.

00:49.200 --> 00:53.350
Now find could be configured to also use a filter,

00:53.370 --> 00:59.550
for example we could find all products that have a title of a book and there are more elaborate filters

00:59.760 --> 01:02.440
than just equality filters available too,

01:02.610 --> 01:06.810
again something I cover in great detail in my mongodb course if you want to learn more about that.

01:07.340 --> 01:07.850
Here I

01:07.890 --> 01:11.090
of course want to find all products for now.

01:11.340 --> 01:17.070
So I want to find all products which I can do by just calling find like this. Now the important thing about

01:17.070 --> 01:21.620
find is find does not immediately return a promise though,

01:21.630 --> 01:24.420
instead it returns a so-called cursor.

01:24.430 --> 01:27.310
A cursor is an object provided by mongodb

01:27.450 --> 01:34.170
which allows us to go through our elements, our documents step by step because theoretically in a collection,

01:34.440 --> 01:39.960
find could of course return millions of documents and you don't want to transfer them over the wire all

01:39.960 --> 01:40.960
at once.

01:41.010 --> 01:45.790
So instead find gives you a handle which you can use to tell mongodb ok

01:45.840 --> 01:50.620
give me the next document, ok give me the next document and so on.

01:50.640 --> 01:57.990
That being said, there is a toArray method you can execute to tell mongodb to get all documents

01:58.080 --> 02:00.080
and turn them into a javascript array

02:00.270 --> 02:06.120
but you should only use that if you know that we're talking about let's say a couple of dozens or maybe

02:06.120 --> 02:07.970
one hundred documents

02:08.260 --> 02:13.710
otherwise it's better to implement pagination which is something we will implement at a later point

02:13.710 --> 02:15.200
of time in this course.

02:15.210 --> 02:19.390
So for now, let's use toArray and then this returns a promise

02:19.470 --> 02:25.330
and here we can again catch any errors we might be getting

02:25.380 --> 02:34.130
but most importantly here, we should have our products and we can log our products here and then also let's

02:34.280 --> 02:38.830
return our products in here and let's see if that works the way we want.

02:39.200 --> 02:42.350
So now we have a fetch all method that hopefully works.

02:42.350 --> 02:48.770
One important thing is I of course need to get access to my database by calling get db in fetch all,

02:48.830 --> 02:50.870
just as I do it in save

02:50.960 --> 02:57.210
and now let's head over to our shop controller and there, we have the get products function.

02:57.380 --> 03:01.340
Now this is the function I want to work on now

03:01.550 --> 03:07.610
and instead of find all, let's now use fetch all because that is how I name the method and there I should

03:07.610 --> 03:12.140
get my products and hopefully I get them in a format that works,

03:12.140 --> 03:13.330
let's see.

03:13.970 --> 03:20.770
Let me also go to my shop routes now and here, get index and get products, that should

03:20.780 --> 03:21.800
be fine,

03:21.830 --> 03:28.130
let me comment out all other routes for the moment because we can't work with them right now because

03:28.640 --> 03:35.090
we have no code that would support them. By the way in the shop controller, you also want to make sure

03:35.300 --> 03:39.620
that get index works by also using fetch all in there,

03:39.620 --> 03:43.950
so just as we did it in get products, we want to do the same in get index.

03:43.990 --> 03:44.620
Ok

03:44.720 --> 03:46.750
so now I got some code in place,

03:47.030 --> 03:54.800
let me go back to app.js finally and comment in that shop routes import and not just comment it in of course

03:54.830 --> 04:01.340
but also uncomment this middleware down there. And now we hopefully have a set up where we can actually

04:01.370 --> 04:05.740
reload our root route

04:05.750 --> 04:08.110
let's say, so just localhost 3000

04:08.210 --> 04:09.520
and here we go,

04:09.530 --> 04:12.060
here is our product just like that

04:12.200 --> 04:16.290
and of course it works automatically because I didn't change any property names.

04:16.400 --> 04:22.120
If you suddenly store the title in a field named name, you would have to adjust your view and so on.

04:22.550 --> 04:30.380
Well and there is something where I want to adjust my view and that is related to how we work with the IDs

04:30.560 --> 04:32.480
but we'll see it in the next lecture.
