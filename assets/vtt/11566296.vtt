WEBVTT

00:02.140 --> 00:07.240
We're nearing the end of this module because we already learned a lot about the core concepts of expressjs

00:07.260 --> 00:12.910
and this therefore is a crucial module because all the rest of the course will basically build up on

00:12.910 --> 00:17.200
this and this knowledge of how expressjs works.

00:17.210 --> 00:24.250
Now even though our dummy app here is really simple thus far, we're already putting all our code into

00:24.260 --> 00:27.240
the single app.js file which is therefore getting bigger.

00:27.490 --> 00:31.170
Now obviously for an app of this size, it's not a problem at all,

00:31.180 --> 00:39.350
it's still pretty small but typically we want to split our routing code over multiple files,

00:39.430 --> 00:44.410
we want to basically export our logic in different files and import it into this file.

00:44.590 --> 00:50.500
We could do this, we could create files where we export these functions but expressjs actually gives

00:50.500 --> 00:54.880
us a pretty nice way of outsourcing routing into other files.

00:55.150 --> 00:57.930
And for this I'll change our folder structure a bit,

00:58.050 --> 01:01.180
I'll add a new folder which I'll name routes.

01:01.360 --> 01:02.650
Now you don't have to name this,

01:02.650 --> 01:04.290
you could name it differently too

01:04.420 --> 01:10.540
but it's a convention you often see, that you put your routing related code, so your code that should execute

01:10.540 --> 01:17.050
four different paths and http methods, that you put that into files which you store in the routes folder

01:17.750 --> 01:23.870
and there since we're building or we're slowly building towards an online shop here,

01:24.130 --> 01:31.300
I'll have a route which I'll name admin.js because this should be the route that handles the creation

01:31.300 --> 01:34.490
of products which the admin of the shop can do.

01:34.480 --> 01:38.370
I'll also add another file and that will be shop.js,

01:38.380 --> 01:44.650
so basically what the users see let's say. Now I'll not build the full shop here, we'll slowly develop it

01:44.710 --> 01:49.910
over to the next lectures and modules because it uses a lot of cool features like databases and so on

01:50.410 --> 01:57.610
but we can at least start putting our code into these files here. The add product route and this product

01:57.610 --> 02:04.300
post request should certainly go into our admin.js file because these are routes that are reached

02:04.720 --> 02:12.230
by the admin and the general route here should go into our shop.js file, so that users that are visiting

02:12.230 --> 02:14.680
our front page see this route.

02:14.680 --> 02:20.680
Now one convenient feature offered by expressjs to achieve this is to go into these files and import

02:20.710 --> 02:27.700
express again, you can and you typically do import this into multiple files and then we can use a feature

02:27.860 --> 02:30.220
of it called the router.

02:30.220 --> 02:35.140
Now you can also create this with a lowercase r at the beginning, the name is totally up to you

02:35.590 --> 02:42.890
and I do create that router by calling express.router and this is a function I execute.

02:42.910 --> 02:50.020
This router is like a mini express app tied to the other express app or pluggable into the other express app

02:50.020 --> 02:52.730
I'll say which we can export here,

02:52.780 --> 02:57.070
so here I can use module exports and set it equal to the router.

02:57.520 --> 02:59.020
Now of course this doesn't do much,

02:59.020 --> 03:05.290
we have to use that router to now register things and actually I'll name this here with a lowercase

03:05.350 --> 03:08.380
r to be in line with my other names,

03:08.380 --> 03:11.340
this however has to have a capital case r.

03:11.890 --> 03:19.660
So now the router here can be used to again define a use function for all requests, a get function

03:19.690 --> 03:22.480
for get, post for post and so on

03:22.690 --> 03:28.930
So basically we can go back to the app.js file, cut these two admin routes from there, put them in

03:28.930 --> 03:36.260
here in the admin.js file and simply replace app with router here.

03:36.300 --> 03:42.620
Now the router gets exported, so the router now has these two routes registered because we exported here

03:42.690 --> 03:48.540
and this is the object on which we registered these routes, the other code can stay as it is because the

03:48.840 --> 03:54.840
router functions here basically work in exactly the same way as the app use function does or the app

03:54.840 --> 03:56.540
get and so on function does,

03:56.850 --> 04:01.920
I'll rename this to get though because I only want to handle get requests to add product and return

04:01.920 --> 04:03.410
this form

04:03.660 --> 04:10.410
and with that, with this exported here, we can now import that into the app.js file.

04:10.440 --> 04:16.200
Now for this, I'll add an import at the top separated from express to make sure or to make clear that

04:16.200 --> 04:22.880
this is my own file and I'll name it admin routes, the name is totally up to you

04:23.040 --> 04:31.510
but I do require a relative path to the routes folder and that in there, the admin file and you can

04:31.510 --> 04:36.900
omit the .js as I already explained, this will be added automatically. So now this is

04:36.910 --> 04:44.380
importing this router object here and this router object in turn has these routes registered and

04:44.500 --> 04:49.600
the nice thing is about this router that it is actually a valid middleware function.

04:49.600 --> 04:56.540
So we can take admin routes and just call app use and put our admin routes in there, just like this,

04:56.650 --> 04:58.390
not calling it like a function,

04:58.450 --> 05:06.340
so without parentheses but simply just the object itself, the router object we're exporting in this file.

05:06.970 --> 05:15.070
We can use this here and now this will automatically consider our routes in the admin.js file when filing

05:15.070 --> 05:17.340
the request through this middleware here.

05:17.410 --> 05:24.440
Now just before, the order matters so if we put this after this middleware, we will never reach that

05:24.460 --> 05:27.120
so this hasn't changed.

05:27.240 --> 05:30.200
Now we can do the same for our front facing route here,

05:30.210 --> 05:35.440
let's go to the shop.js file and there again, feel free to pause the video and try this on your own,

05:35.460 --> 05:43.560
try to implement this with the express router as we just did in the admin.js file. Were you successful?

05:43.580 --> 05:51.410
Let's import express first of all by requiring express, then let's create that router object by calling

05:51.410 --> 05:54.440
express.router as a function,

05:54.890 --> 05:57.670
let's export the router here

05:58.960 --> 06:06.910
and let's then use app use or paste in what I copied but replace app with router and maybe use with

06:06.910 --> 06:14.320
get. You don't have to do that, the use method would exist too but now we only handle get requests here.

06:14.450 --> 06:21.560
Now we can go back to admin.js, excuse me, to app.js and import all routes there too, the order of the

06:21.560 --> 06:23.280
imports doesn't matter,

06:23.450 --> 06:30.310
so my shop routes I require them from the routes folder and there from the shop.js file

06:30.560 --> 06:35.230
and now here again, the order matters, we should register this second.

06:35.240 --> 06:40.720
Now if I save this and I reload add routes, add product, this works.

06:40.730 --> 06:43.200
Now actually here's one important thing to understand,

06:44.050 --> 06:53.270
even if I would switch the position here and have shop routes first and I reload, it would work and we

06:53.270 --> 06:55.470
would not end up in this route

06:55.610 --> 07:02.810
but this only happens because I have get here. Get, post and so on will actually do an exact match here.

07:03.140 --> 07:10.860
If I would use use here as I did before to handle any incoming http method, then if I reload here we see

07:10.860 --> 07:12.550
hello from express again.

07:12.800 --> 07:18.830
So this exact matching is not achieved by using the router but because we use get here and that would

07:18.830 --> 07:24.790
have been the same if we stick to the app way of doing this in the app.js file we had previously.

07:24.980 --> 07:26.810
So get,

07:26.810 --> 07:32.160
also make sure that it's not just a get method but this exact path and therefore

07:32.300 --> 07:39.770
now if I enter some random stuff, I actually get an error because now I got no single middleware that

07:39.770 --> 07:41.120
would handle this

07:41.330 --> 07:46.190
but I do have my route set up here now and split up and then registered here

07:46.310 --> 07:51.620
and as I mentioned, it's not the worst practice to still care about the order here

07:51.800 --> 07:55.610
even though at the moment, it'll work fine no matter what the order is

07:55.610 --> 08:01.220
but if you ever change something back to use, it would matter and therefore why don't we just care about

08:01.220 --> 08:02.520
it right from the start.
