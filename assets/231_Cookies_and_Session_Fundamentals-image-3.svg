<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="847px" height="1074px" viewBox="-0.5 -0.5 847 1074" content="&lt;mxfile host=&quot;Electron&quot; modified=&quot;2023-08-06T14:37:37.142Z&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.5 Chrome/114.0.5735.243 Electron/25.3.1 Safari/537.36&quot; etag=&quot;4Io2Pye5nbZgv6F0tlI8&quot; version=&quot;21.6.5&quot; type=&quot;device&quot;&gt;&#10;  &lt;diagram id=&quot;Urch9LiheC-z1pz3Ezmb&quot; name=&quot;Page-2&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;474&quot; dy=&quot;854&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;850&quot; pageHeight=&quot;1100&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-4&quot; value=&quot;&quot; style=&quot;group&quot; parent=&quot;1&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;170&quot; y=&quot;30&quot; width=&quot;487&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-1&quot; value=&quot;&amp;lt;font style=&amp;quot;font-size: 48px;&amp;quot;&amp;gt;Sessions&amp;lt;/font&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontFamily=Monaco;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;145&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-3&quot; value=&quot;(one way to implement - auth without each request password)&quot; style=&quot;text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;200&quot; width=&quot;350&quot; height=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-77&quot; value=&quot;&amp;lt;h1&amp;gt;Optimization 1 - we don&amp;#39;t need a table&amp;lt;/h1&amp;gt;&amp;lt;p&amp;gt;The current (above) flow involves a database call, which is expensive to do for each and every request&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;On the other hand, a simple decryption of a string is a fas operation. So instead of the using a table (database), we could encrypt the user details (user_id here) using a key that&amp;#39;s only known to the server.&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Note: if you don&amp;#39;t want to involve encryption, sessions are still a valid concept (send the id unencrypted - it&amp;#39;s a random string anyway). But you&amp;#39;ll need to maintain a database.&amp;lt;/p&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;labelBorderColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;187&quot; y=&quot;670&quot; width=&quot;190&quot; height=&quot;400&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-79&quot; value=&quot;&amp;lt;h1&amp;gt;Optimization 2 - send token back with each response&amp;lt;/h1&amp;gt;&amp;lt;p&amp;gt;To prevent cookie stealing (which takes some human time), we can change the session encryption key each day (or some other period).&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;But why send the token back for every request - well, when the key changes, all existing sessions will be invalidated, forcing the user to sign in again (in order to generate a fresh token). This can be annoying for the user.&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;Instead we can potentially send new session token with each response. Potentially meaning we would send the same token if it&amp;#39;s valid, but if the token is valid and the time is nearing for key change, we&amp;#39;ll generate a new token and send that instead.&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;This way, we can prevent the force login issue &amp;lt;br&amp;gt;for a majority of users. A small number of users &amp;lt;br&amp;gt;will have to login again, of course - if they were inactive when the session encryption key has changed in that time.&amp;lt;/p&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;labelBorderColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;377&quot; y=&quot;670&quot; width=&quot;280&quot; height=&quot;420&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-80&quot; value=&quot;&amp;lt;h1&amp;gt;What&amp;#39;s the role of a cookie in all this?&amp;lt;/h1&amp;gt;&amp;lt;p&amp;gt;Since we forego the need for username and password for each request, the client would need to send the session token (encrypted user data) for each request.&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;JS cannot be used to do this, since the first call would never be authenticated (the page doesn&amp;#39;t exist, let alone using `fetch` API).&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;Even for SPA calls, adding logic to send and receive cookies would be tiring.&amp;amp;nbsp;&amp;lt;/p&amp;gt;&amp;lt;p&amp;gt;Fortunately cookies allow us to do all this (including on first page load). So it&amp;#39;s both convenient and required.&amp;lt;/p&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;labelBorderColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;657&quot; y=&quot;670&quot; width=&quot;190&quot; height=&quot;410&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uUl0tFM7B6o-X8zgO_2k-1&quot; value=&quot;&quot; style=&quot;group&quot; parent=&quot;1&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;34&quot; y=&quot;120&quot; width=&quot;30&quot; height=&quot;450&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-10&quot; value=&quot;User 1&quot; style=&quot;shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;130&quot; width=&quot;30&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-12&quot; value=&quot;User 2&quot; style=&quot;shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;260&quot; width=&quot;30&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-13&quot; value=&quot;User 3&quot; style=&quot;shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;390&quot; width=&quot;30&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-58&quot; value=&quot;user x&quot; style=&quot;shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;30&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uUl0tFM7B6o-X8zgO_2k-2&quot; value=&quot;&quot; style=&quot;group&quot; parent=&quot;1&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;757&quot; y=&quot;240&quot; width=&quot;60&quot; height=&quot;340&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-17&quot; value=&quot;user 1 data&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-2&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;60&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-20&quot; value=&quot;user 3 data&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-2&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;260&quot; width=&quot;60&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-21&quot; value=&quot;user 2 data&quot; style=&quot;shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-2&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;130&quot; width=&quot;60&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; value=&quot;&quot; style=&quot;group&quot; parent=&quot;1&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;97&quot; y=&quot;100&quot; width=&quot;610&quot; height=&quot;460&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-29&quot; value=&quot;Table&quot; style=&quot;shape=table;startSize=30;container=1;collapsible=0;childLayout=tableLayout;strokeColor=default;fontSize=16;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;340&quot; width=&quot;170&quot; height=&quot;150&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-30&quot; value=&quot;&quot; style=&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-29&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;30&quot; width=&quot;170&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-31&quot; value=&quot;session_id&quot; style=&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-30&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;85&quot; height=&quot;40&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle width=&quot;85&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-32&quot; value=&quot;user_id&quot; style=&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-30&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;85&quot; width=&quot;85&quot; height=&quot;40&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle width=&quot;85&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-34&quot; value=&quot;&quot; style=&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-29&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;70&quot; width=&quot;170&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-35&quot; value=&quot;&quot; style=&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-34&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;85&quot; height=&quot;40&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle width=&quot;85&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-36&quot; value=&quot;&quot; style=&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-34&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;85&quot; width=&quot;85&quot; height=&quot;40&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle width=&quot;85&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-38&quot; value=&quot;&quot; style=&quot;shape=tableRow;horizontal=0;startSize=0;swimlaneHead=0;swimlaneBody=0;strokeColor=inherit;top=0;left=0;bottom=0;right=0;collapsible=0;dropTarget=0;fillColor=none;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-29&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;110&quot; width=&quot;170&quot; height=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-39&quot; value=&quot;&quot; style=&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-38&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;85&quot; height=&quot;40&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle width=&quot;85&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-40&quot; value=&quot;&quot; style=&quot;shape=partialRectangle;html=1;whiteSpace=wrap;connectable=0;strokeColor=inherit;overflow=hidden;fillColor=none;top=0;left=0;bottom=0;right=0;pointerEvents=1;fontSize=16;&quot; parent=&quot;fL3uzg5f9puYug-alVnK-38&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;85&quot; width=&quot;85&quot; height=&quot;40&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle width=&quot;85&quot; height=&quot;40&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-72&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; target=&quot;fL3uzg5f9puYug-alVnK-55&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint y=&quot;90&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-73&quot; value=&quot;request /login&quot; style=&quot;edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];&quot; parent=&quot;fL3uzg5f9puYug-alVnK-72&quot; vertex=&quot;1&quot; connectable=&quot;0&quot;&gt;&#10;          &lt;mxGeometry x=&quot;0.0142&quot; y=&quot;-1&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint as=&quot;offset&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-55&quot; value=&quot;login&quot; style=&quot;shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;95&quot; y=&quot;60&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-57&quot; value=&quot;verify_token&quot; style=&quot;rhombus;whiteSpace=wrap;html=1;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;115&quot; y=&quot;235&quot; width=&quot;80&quot; height=&quot;80&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-62&quot; value=&quot;request&quot; style=&quot;endArrow=classic;html=1;rounded=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; target=&quot;fL3uzg5f9puYug-alVnK-57&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;50&quot; height=&quot;50&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint y=&quot;275&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;110&quot; y=&quot;274.5&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-67&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; source=&quot;fL3uzg5f9puYug-alVnK-64&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;610&quot; y=&quot;275&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-64&quot; value=&quot;get user id&quot; style=&quot;shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;360&quot; y=&quot;245&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-63&quot; value=&quot;valid&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; source=&quot;fL3uzg5f9puYug-alVnK-57&quot; target=&quot;fL3uzg5f9puYug-alVnK-64&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;290&quot; y=&quot;275&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-65&quot; value=&quot;get&quot; style=&quot;shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;100&quot; height=&quot;100&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;430&quot; y=&quot;235&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;430&quot; y=&quot;165&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-68&quot; value=&quot;success with data&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; target=&quot;fL3uzg5f9puYug-alVnK-66&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;590&quot; y=&quot;430&quot; as=&quot;sourcePoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-69&quot; value=&quot;response&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; source=&quot;fL3uzg5f9puYug-alVnK-66&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint y=&quot;430&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-66&quot; value=&quot;ready_response&quot; style=&quot;shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry x=&quot;260&quot; y=&quot;400&quot; width=&quot;120&quot; height=&quot;60&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-70&quot; value=&quot;unauthorized&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; source=&quot;fL3uzg5f9puYug-alVnK-57&quot; target=&quot;fL3uzg5f9puYug-alVnK-66&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;fL3uzg5f9puYug-alVnK-75&quot; value=&quot;generate&quot; style=&quot;shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;&quot; parent=&quot;uUl0tFM7B6o-X8zgO_2k-4&quot; source=&quot;fL3uzg5f9puYug-alVnK-34&quot; target=&quot;fL3uzg5f9puYug-alVnK-55&quot; edge=&quot;1&quot;&gt;&#10;          &lt;mxGeometry width=&quot;100&quot; height=&quot;100&quot; relative=&quot;1&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxPoint x=&quot;300&quot; y=&quot;91&quot; as=&quot;sourcePoint&quot; /&gt;&#10;            &lt;mxPoint x=&quot;215&quot; y=&quot;91&quot; as=&quot;targetPoint&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;diCH60x2FcZCsfUx4Clo-1&quot; value=&quot;&amp;lt;h1&amp;gt;Implementation&amp;lt;/h1&amp;gt;&amp;lt;p&amp;gt;The current (above) flow involves a database call, which is expensive to do for each and every request&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;On the other hand, a simple decryption of a string is a fas operation. So instead of the using a table (database), we could encrypt the user details (user_id here) using a key that&amp;#39;s only known to the server.&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;Note: if you don&amp;#39;t want to involve encryption, sessions are still a valid concept (send the id unencrypted - it&amp;#39;s a random string anyway). But you&amp;#39;ll need to maintain a database.&amp;lt;/p&amp;gt;&quot; style=&quot;text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;labelBorderColor=default;&quot; parent=&quot;1&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry y=&quot;670&quot; width=&quot;190&quot; height=&quot;390&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 143px; height: 1px; padding-top: 29px; margin-left: 171px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 24px; font-family: Monaco; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><font style="font-size: 48px;">Sessions</font></div></div></div></foreignObject><text x="243" y="36" fill="rgb(240, 240, 240)" font-family="Monaco" font-size="24px" text-anchor="middle">Sessions</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 29px; margin-left: 545px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: nowrap;">(one way to implement - auth without each request password)</div></div></div></foreignObject><text x="545" y="33" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">(one way to implement - auth without each request password)</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 182px; height: 1px; padding-top: 644px; margin-left: 192px;"><div data-drawio-colors="color: rgb(240, 240, 240); border-color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 410px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; border: 1px solid rgb(240, 240, 240); white-space: normal; overflow-wrap: normal;"><h1>Optimization 1 - we don't need a table</h1><p>The current (above) flow involves a database call, which is expensive to do for each and every request<br /><br />On the other hand, a simple decryption of a string is a fas operation. So instead of the using a table (database), we could encrypt the user details (user_id here) using a key that's only known to the server.<br /><br />Note: if you don't want to involve encryption, sessions are still a valid concept (send the id unencrypted - it's a random string anyway). But you'll need to maintain a database.</p></div></div></div></foreignObject><text x="192" y="656" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">Optimization 1 - we don't need...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 272px; height: 1px; padding-top: 644px; margin-left: 382px;"><div data-drawio-colors="color: rgb(240, 240, 240); border-color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 430px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; border: 1px solid rgb(240, 240, 240); white-space: normal; overflow-wrap: normal;"><h1>Optimization 2 - send token back with each response</h1><p>To prevent cookie stealing (which takes some human time), we can change the session encryption key each day (or some other period).</p><p>But why send the token back for every request - well, when the key changes, all existing sessions will be invalidated, forcing the user to sign in again (in order to generate a fresh token). This can be annoying for the user.</p><p>Instead we can potentially send new session token with each response. Potentially meaning we would send the same token if it's valid, but if the token is valid and the time is nearing for key change, we'll generate a new token and send that instead.</p><p>This way, we can prevent the force login issue <br />for a majority of users. A small number of users <br />will have to login again, of course - if they were inactive when the session encryption key has changed in that time.</p></div></div></div></foreignObject><text x="382" y="656" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">Optimization 2 - send token back with each re...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 182px; height: 1px; padding-top: 644px; margin-left: 662px;"><div data-drawio-colors="color: rgb(240, 240, 240); border-color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 420px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; border: 1px solid rgb(240, 240, 240); white-space: normal; overflow-wrap: normal;"><h1>What's the role of a cookie in all this?</h1><p>Since we forego the need for username and password for each request, the client would need to send the session token (encrypted user data) for each request.</p><p>JS cannot be used to do this, since the first call would never be authenticated (the page doesn't exist, let alone using `fetch` API).</p><p>Even for SPA calls, adding logic to send and receive cookies would be tiring. </p><p>Fortunately cookies allow us to do all this (including on first page load). So it's both convenient and required.</p></div></div></div></foreignObject><text x="662" y="656" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">What's the role of a cookie in...</text></switch></g><ellipse cx="49" cy="241.5" rx="7.5" ry="7.5" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" pointer-events="none"/><path d="M 49 249 L 49 274 M 49 254 L 34 254 M 49 254 L 64 254 M 49 274 L 34 294 M 49 274 L 64 294" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 301px; margin-left: 49px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: nowrap;">User 1</div></div></div></foreignObject><text x="49" y="313" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">User 1</text></switch></g><ellipse cx="49" cy="371.5" rx="7.5" ry="7.5" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" pointer-events="none"/><path d="M 49 379 L 49 404 M 49 384 L 34 384 M 49 384 L 64 384 M 49 404 L 34 424 M 49 404 L 64 424" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 431px; margin-left: 49px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: nowrap;">User 2</div></div></div></foreignObject><text x="49" y="443" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">User 2</text></switch></g><ellipse cx="49" cy="501.5" rx="7.5" ry="7.5" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" pointer-events="none"/><path d="M 49 509 L 49 534 M 49 514 L 34 514 M 49 514 L 64 514 M 49 534 L 34 554 M 49 534 L 64 554" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 561px; margin-left: 49px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: nowrap;">User 3</div></div></div></foreignObject><text x="49" y="573" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">User 3</text></switch></g><ellipse cx="49" cy="111.5" rx="7.5" ry="7.5" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" pointer-events="none"/><path d="M 49 119 L 49 144 M 49 124 L 34 124 M 49 124 L 64 124 M 49 144 L 34 164 M 49 144 L 64 164" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 171px; margin-left: 49px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: nowrap;">user x</div></div></div></foreignObject><text x="49" y="183" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">user x</text></switch></g><path d="M 757 239 C 757 230.72 770.43 224 787 224 C 794.96 224 802.59 225.58 808.21 228.39 C 813.84 231.21 817 235.02 817 239 L 817 289 C 817 297.28 803.57 304 787 304 C 770.43 304 757 297.28 757 289 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 817 239 C 817 247.28 803.57 254 787 254 C 770.43 254 757 247.28 757 239" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 277px; margin-left: 758px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user 1 data</div></div></div></foreignObject><text x="787" y="280" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">user 1 data</text></switch></g><path d="M 757 499 C 757 490.72 770.43 484 787 484 C 794.96 484 802.59 485.58 808.21 488.39 C 813.84 491.21 817 495.02 817 499 L 817 549 C 817 557.28 803.57 564 787 564 C 770.43 564 757 557.28 757 549 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 817 499 C 817 507.28 803.57 514 787 514 C 770.43 514 757 507.28 757 499" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 537px; margin-left: 758px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user 3 data</div></div></div></foreignObject><text x="787" y="540" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">user 3 data</text></switch></g><path d="M 757 369 C 757 360.72 770.43 354 787 354 C 794.96 354 802.59 355.58 808.21 358.39 C 813.84 361.21 817 365.02 817 369 L 817 419 C 817 427.28 803.57 434 787 434 C 770.43 434 757 427.28 757 419 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 817 369 C 817 377.28 803.57 384 787 384 C 770.43 384 757 377.28 757 369" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 58px; height: 1px; padding-top: 407px; margin-left: 758px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user 2 data</div></div></div></foreignObject><text x="787" y="410" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">user 2 data</text></switch></g><path d="M 437 114 L 437 84 L 607 84 L 607 114" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 437 114 L 437 234 L 607 234 L 607 114" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 437 114 L 607 114" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 437 154 L 522 154 L 607 154" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 437 194 L 522 194 L 607 194" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 522 114 L 522 154 L 522 194 L 522 234" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(240, 240, 240)" font-family="Helvetica" pointer-events="none" text-anchor="middle" font-size="16px"><text x="521.5" y="105.5">Table</text></g><path d="M 437 114 M 522 114 M 522 154 M 437 154" fill="none" stroke="rgb(240, 240, 240)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 83px; height: 1px; padding-top: 134px; margin-left: 438px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">session_id</div></div></div></foreignObject><text x="480" y="139" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="16px" text-anchor="middle">session_id</text></switch></g><path d="M 522 114 M 607 114 M 607 154 M 522 154" fill="none" stroke="rgb(240, 240, 240)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 83px; height: 1px; padding-top: 134px; margin-left: 523px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id</div></div></div></foreignObject><text x="565" y="139" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="16px" text-anchor="middle">user_id</text></switch></g><path d="M 437 154 M 522 154 M 522 194 M 437 194" fill="none" stroke="rgb(240, 240, 240)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><path d="M 522 154 M 607 154 M 607 194 M 522 194" fill="none" stroke="rgb(240, 240, 240)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><path d="M 437 194 M 522 194 M 522 234 M 437 234" fill="none" stroke="rgb(240, 240, 240)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><path d="M 522 194 M 607 194 M 607 234 M 522 234" fill="none" stroke="rgb(240, 240, 240)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><path d="M 97 174 L 145 174.5 L 195.63 174.06" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 200.88 174.01 L 193.91 177.57 L 195.63 174.06 L 193.85 170.57 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 176px; margin-left: 151px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">request /login</div></div></div></foreignObject><text x="151" y="179" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">request /login</text></switch></g><path d="M 192 204 L 212 144 L 312 144 L 292 204 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 174px; margin-left: 193px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">login</div></div></div></foreignObject><text x="252" y="178" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">login</text></switch></g><path d="M 252 319 L 292 359 L 252 399 L 212 359 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 359px; margin-left: 213px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">verify_token</div></div></div></foreignObject><text x="252" y="363" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">verify_token</text></switch></g><path d="M 97 359 L 205.63 359" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 210.88 359 L 203.88 362.5 L 205.63 359 L 203.88 355.5 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 359px; margin-left: 155px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">request</div></div></div></foreignObject><text x="155" y="362" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">request</text></switch></g><path d="M 567 359 L 642 359 L 700.63 359" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 705.88 359 L 698.88 362.5 L 700.63 359 L 698.88 355.5 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 457 389 L 477 329 L 577 329 L 557 389 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 359px; margin-left: 458px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">get user id</div></div></div></foreignObject><text x="517" y="363" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">get user id</text></switch></g><path d="M 292 359 L 460.63 359" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 465.88 359 L 458.88 362.5 L 460.63 359 L 458.88 355.5 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 359px; margin-left: 380px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">valid</div></div></div></foreignObject><text x="380" y="362" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">valid</text></switch></g><path d="M 532 299.5 L 542.5 299.5 L 527 318.5 L 511.5 299.5 L 522 299.5 L 522 268.5 L 511.5 268.5 L 527 249.5 L 542.5 268.5 L 532 268.5 Z" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 284px; margin-left: 527px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">get</div></div></div></foreignObject><text x="527" y="287" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">get</text></switch></g><path d="M 687 514 L 582 514.5 L 473.37 514.03" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 468.12 514 L 475.13 510.54 L 473.37 514.03 L 475.1 517.54 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 514px; margin-left: 578px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">success with data</div></div></div></foreignObject><text x="578" y="517" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">success with data</text></switch></g><path d="M 367 514 L 227.5 514 L 103.37 514" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 98.12 514 L 105.12 510.5 L 103.37 514 L 105.12 517.5 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 514px; margin-left: 232px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">response</div></div></div></foreignObject><text x="232" y="517" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">response</text></switch></g><path d="M 357 544 L 377 484 L 477 484 L 457 544 Z" fill="rgb(24, 20, 29)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 514px; margin-left: 358px;"><div data-drawio-colors="color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">ready_response</div></div></div></foreignObject><text x="417" y="518" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px" text-anchor="middle">ready_response</text></switch></g><path d="M 252 399 L 252 441.5 L 417 441.5 L 417 477.63" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><path d="M 417 482.88 L 413.5 475.88 L 417 477.63 L 420.5 475.88 Z" fill="rgb(240, 240, 240)" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 442px; margin-left: 335px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">unauthorized</div></div></div></foreignObject><text x="335" y="445" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">unauthorized</text></switch></g><path d="M 417.5 169 L 417.5 158.5 L 436.5 174 L 417.5 189.5 L 417.5 179 L 321.5 179 L 321.5 189.5 L 302.5 174 L 321.5 158.5 L 321.5 169 Z" fill="none" stroke="rgb(240, 240, 240)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 174px; margin-left: 369px;"><div data-drawio-colors="color: rgb(240, 240, 240); background-color: rgb(24, 20, 29); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; background-color: rgb(24, 20, 29); white-space: nowrap;">generate</div></div></div></foreignObject><text x="369" y="177" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="11px" text-anchor="middle">generate</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 182px; height: 1px; padding-top: 644px; margin-left: 5px;"><div data-drawio-colors="color: rgb(240, 240, 240); border-color: rgb(240, 240, 240); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 400px; overflow: hidden;"><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(240, 240, 240); line-height: 1.2; pointer-events: none; border: 1px solid rgb(240, 240, 240); white-space: normal; overflow-wrap: normal;"><h1>Implementation</h1><p>The current (above) flow involves a database call, which is expensive to do for each and every request<br /><br />On the other hand, a simple decryption of a string is a fas operation. So instead of the using a table (database), we could encrypt the user details (user_id here) using a key that's only known to the server.<br /><br />Note: if you don't want to involve encryption, sessions are still a valid concept (send the id unencrypted - it's a random string anyway). But you'll need to maintain a database.</p></div></div></div></foreignObject><text x="5" y="656" fill="rgb(240, 240, 240)" font-family="Helvetica" font-size="12px">Implementation...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.drawio.com/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>