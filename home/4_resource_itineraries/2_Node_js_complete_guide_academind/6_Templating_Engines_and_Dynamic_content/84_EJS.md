# 84. EJS
Created Wednesday 8 March 2023 at 04:48 pm

- Has Express.js support out of the box.
- Uses HTML for markup, a very small DSL and JS code can be used freely.
- It's quite like ERB (Ruby).


## Steps to use with Express
1. Install EJS - `npm install ejs`
2. Set view engine in Express (just like Pug):
	```js
	app.set('view engine', 'ejs');
	app.set('views', 'views'); // since our templates are at my-proj/views
	```
3. Passing props remains the same:
	```js
	res.render('path-to-template-inside-views', { name: "Sanjar"});
	```

## Template usage
1. UI Markup is HTML, no special syntax here.
2. EJS files end in `.ejs`
3. DSL:
	1. `<%= renderablePropOrCode %>` - render the prop or code (assuming it's render-able)
	2. `<% users.length + 1 %>` - JS code for control flow, no output. Can be used in multi-line way, with markup between these blocks.
	3. `<%- "<p>" + "Hello, world" + "</p>" %>` - render unescaped HTML/EJS. **Not used very much - except for re-usability among templates**

Note:
- Nesting among these is fine
- The JS code is not fully free form - e.g only `} else {` works, splittling this into multiple blocks will throw error. Advice - assume blocks are always needed, and don't do unnecessary gymnastics.
- XSS attack for unescaped HTML is not a concern (for code generated by our templates), since we're the server.
- Props are passed down automatically if partials (`include`) is used.

## Working with partials
Why - code reuse among templates.

A partial is simply a EJS file can be imported in another EJS file. Since this file is not a complete page - i.e. has partial code.

Steps to use:
1. Write part to be used elsewhere, in an EJS file.
2. Keep this file somewhere inside `views` folder.
3. In another EJS file (the one importing), use `include('path-to-partial-template-inside-view-folder')`. That's it. Props are passed down automatically.

Example:
```ejs
%% shop.ejs %%
<h1>Shop page</h1>
<nav>... some code here </nav>
```
may be broken down (assuming "nav" code is used on other pages)
```ejs
%% navigation.ejs %%
<nav>... some code here </nav>
```
```ejs
%% shop.ejs %%
<h1>Shop page</h1>
<%- include('navigation.ejs')  %>
```
We are using unescaped DSL tag (`<%- %>`) since we need to treat imported code as markup, not plain text.

All pages using "nav" can do the same.

Note:
- We don't (need to) specify/set path to partials using JS code. EJS looks in folder containing the template, we can construct the path from there (as we did here).
- Of course, passing `path` and `__dirname` as props to construct path to partial would still work, since `include()` does accept an absolute path. **Not needed generally, just mentioning that it's possible**.
- EJS can be used without Express too, and also in the browser. [See - experiment with SSG with EJS](https://github.com/exemplar-codes/templating-engines-w-express-js/commit/e8f6cd62e4156c0420444b33bf0771e423e17ad1).

## Examples
```ejs
%% simple render %%
%% [Code example](https://github.com/exemplar-codes/templating-engines-w-express-js/commit/d5c842a) %%

<h1><%= welcomeMessage %></h1>

<h1><%= "Hi, " + name + "!" %></h1>

<%= "<p>HTML is escaped by default, so printed like plain text</p>" %>
```
```ejs
%% JS code is allowed, though not rendered %%
%% [Code example](https://github.com/exemplar-codes/templating-engines-w-express-js/commit/18a7124) %%

<% if(showPicture) { %>
	<img src="<%= imgURL %>" alt="<%= imgAltText %>" />
<% } %>

%% This not completely free flow - assume blocks are always needed and keep them together %%

<% if(isFirstChessPlayer) { %>
	<h1>Hi, you're <em>white</em>
<% } else %>
	<h1>Please wait, you're <em>black</em>
<% } %>
```
```ejs
%% Unescaped HTML/EJS code - used for importing EJS code from files %%
%% XSS attack is not a concern, from us, since we are the server %%

%% [Code example](https://github.com/exemplar-codes/templating-engines-w-express-js/commit/402bf6fa2bd4309b34fdd8aa6f747b2c0d4f678d) %%

<%- `<button class="btn" type="submit">Add Product</button>` %>

<%- include('includes/navigation.ejs') %>
```


## Almost all EJS functionality
I know the syntax already, adding this for the sake of exhaustiveness.
![](../../../../assets/Pasted%20image%2020230308191638.png)