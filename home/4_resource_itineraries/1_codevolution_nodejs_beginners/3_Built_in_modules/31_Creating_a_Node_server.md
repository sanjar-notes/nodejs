# 31. Creating a Node server
Created Sunday 29 January 2023 at 10:45 pm

// FIXME: rough
Let's write code to create a web server.

Also, the `http` module extends the EventEmitter class.

To create a server, use the `http.createServer(callback)`. The "callback" here is the request listener, i.e. it runs when a request is received.

The callback receives two arguments -  request and response. The request param contains info about the request. The response argument is used to "build" the response we wish to send back. Of course, they can be named anything. Popular names are (req, res), (request, response).

We can end request processing (and start responding) by using `response.end(some_string)` method which optionally accepts a string. `res.end()`(optionally with preceding `res.write()`) is meant for building the [response](https://developer.mozilla.org/en-US/docs/Web/HTTP/Overview#responses) body.

`res.writeHead(statusCode [, headerObject])` can be used to specify the response status code and (optionally) header values.

To start listening for requests (i.e. start the server), use the `myServer.listen(port_number[, callback])` method. Think of it as a door number in an apartment that has many houses. Optionally, we can pass a callback function that's called when the server starts. It has no params.

[Code](https://github.com/exemplar-codes/codevolution-nodejs/commit/089f7f8b64123ed80746eefc487a9af2c563ae64)

So, it's very easy to get started with making servers with Node.js.

---
Although not necessary, it is a a good practice to specify the "Content-Type" header. "Content-Type": "text/plain" is the one if `response.end(string)` is used. Technically, browsers guess (default being "text/plain") the response "Content-Type" is it's not specified.

[Code](https://github.com/exemplar-codes/codevolution-nodejs/commit/12f6d1c5c25c03695994fc6c8472a88d4c660221)

Note: a plaintext response is not the same as an HTML response. Both are strings, yes, but they're interpreted differently. The "Content-Type" header is used for choosing the interpretation. A plaintext response could be ignored by the browser, and HTML one is always rendered. In case of Chrome (and other popular browsers), a plaintext response will be rendered within an HTML page generated by the browser itself.

---
Let's go through the flow once again:
1. The server starts are listens for incoming requests at the give port.
2. When a request is received, Node.js runs the callback. This happens for each incoming request.
3. Node.js automatically injects request and response params in the callback.
4. request object contains data and related methods about the request.
5. response object is an "actionable" parameter, i.e. response object is used to run code, "build" the response and finally send the response. It also contains data.

---
- To run the server on a free and random port, pass 0 as the port number
- To get the assigned port number, use `myServer.address().port` once the server starts, for example, inside the `myServer.listen` callback.

Example:
```js
const http = require("node:http");

const server = http.createServer((req, res) => {
  res.writeHead(200); // status code
  res.end("Hello world");
});

server.listen(0, () => {
  // 0 means random port
  console.log(`Server started on PORT ${server.address().port}`);
});
```
[Code](https://github.com/exemplar-codes/codevolution-nodejs/commit/875e861a984dcbf0cba58e559a18abf9e2dfa055)

See also: [Code - start server at random port and open browser](https://github.com/exemplar-codes/codevolution-nodejs/commit/872d3ac427275ecb18e51ae5e38841bed321a624). 